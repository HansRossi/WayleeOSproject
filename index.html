<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INFOS: Code for Life</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif;
            image-rendering: pixelated;
        }

        :root {
            --primary: #007AFF;
            --primary-dark: #0051D5;
            --success: #34C759;
            --warning: #FF9500;
            --error: #FF3B30;
            --purple: #AF52DE;
            --gold: #FFD60A;
            --bg-primary: #000000;
            --bg-secondary: #1C1C1E;
            --bg-tertiary: #2C2C2E;
            --border: #38383A;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
        }

        body {
            background: #000000;
            color: var(--text-primary);
            overflow: hidden;
            user-select: none;
            position: relative;
        }

        /* Allow text selection in input fields */
        input, textarea {
            user-select: text !important;
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
        }

        /* ===== COSMIC STARFIELD BACKGROUND ===== */
        .cosmic-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: #000000;
            overflow: hidden;
        }

        .star {
            position: absolute;
            background: #FFFFFF;
            border-radius: 50%;
            box-shadow: 0 0 4px rgba(255, 255, 255, 0.8), 0 0 8px rgba(255, 255, 255, 0.4);
            animation: starTwinkle 4s ease-in-out infinite;
        }

        @keyframes starTwinkle {
            0%, 100% { 
                opacity: 0.6;
                transform: scale(1);
            }
            50% { 
                opacity: 1;
                transform: scale(1.3);
            }
        }

        /* Animated shooting stars */
        .shooting-star {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0.8), transparent);
            border-radius: 2px;
            box-shadow: 0 0 6px rgba(255, 255, 255, 0.8), 0 0 12px rgba(255, 255, 255, 0.4);
            animation: shoot 3s ease-out forwards;
        }

        @keyframes shoot {
            0% {
                transform: translateX(0) translateY(0) rotate(-45deg);
                opacity: 1;
            }
            70% {
                opacity: 0.8;
            }
            100% {
                transform: translateX(-600px) translateY(400px) rotate(-45deg);
                opacity: 0;
            }
        }

        /* Subtle nebula glow */
        .nebula {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.25;
            pointer-events: none;
        }

        @keyframes nebulaFloat {
            0%, 100% { 
                transform: translate(0, 0) scale(1);
            }
            50% { 
                transform: translate(30px, 20px) scale(1.1);
            }
        }

        /* All elements above background */
        .loading-screen,
        .character-selection,
        .game-container {
            position: relative;
            z-index: 10;
        }

        /* ===== APPLE-STYLE LOADING SCREEN ===== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-title {
            font-size: 64px;
            font-weight: 700;
            margin-bottom: 80px;
            letter-spacing: -2px;
            color: #FFFFFF;
            text-align: center;
            line-height: 1.1;
            opacity: 0;
            animation: fadeInTitle 0.8s ease-out 0.2s forwards;
        }

        .loading-title span {
            color: #6366f1;
            text-shadow: 0 0 20px rgba(99, 102, 241, 0.6);
        }

        @keyframes fadeInTitle {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading-container {
            width: 300px;
            max-width: 90%;
            opacity: 0;
            animation: fadeInContainer 0.8s ease-out 0.5s forwards;
        }

        @keyframes fadeInContainer {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading-bar-container {
            width: 100%;
            height: 3px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .loading-bar {
            height: 100%;
            background: #FFFFFF;
            width: 0%;
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 10px;
        }

        .loading-text {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
            text-align: center;
            font-weight: 500;
            letter-spacing: 0.3px;
            margin-bottom: 8px;
        }

        .loading-details {
            display: flex;
            justify-content: space-between;
            color: rgba(255, 255, 255, 0.4);
            font-size: 12px;
            font-weight: 400;
            margin-top: 12px;
        }

        .loading-animation {
            margin-top: 60px;
            text-align: center;
            font-size: 40px;
            opacity: 0;
            animation: fadeInIcon 0.8s ease-out 0.8s forwards, floatIcon 3s ease-in-out 1.6s infinite;
        }

        @keyframes fadeInIcon {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 0.9;
                transform: scale(1);
            }
        }

        @keyframes floatIcon {
            0%, 100% { 
                transform: translateY(0);
            }
            50% { 
                transform: translateY(-10px);
            }
        }

        /* ===== CHARACTER SELECTION ===== */
        .character-selection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 60px 40px;
        }

        .game-title {
            font-size: 64px;
            color: #FFFFFF;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -2px;
        }

        .game-title span {
            color: #6366f1;
            text-shadow: 0 0 20px rgba(99, 102, 241, 0.6);
        }

        .game-subtitle {
            color: rgba(255, 255, 255, 0.6);
            font-size: 17px;
            margin-bottom: 64px;
            text-align: center;
            max-width: 580px;
            line-height: 1.5;
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        .characters-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            max-width: 1200px;
            margin-bottom: 48px;
        }

        .character-card {
            background: rgba(28, 28, 30, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .character-card:hover {
            background: rgba(28, 28, 30, 0.8);
            border-color: rgba(0, 122, 255, 0.6);
            transform: translateY(-4px);
        }

        .character-card.selected {
            border-color: var(--primary);
            background: rgba(0, 122, 255, 0.1);
            box-shadow: 0 0 0 1px var(--primary) inset;
        }

        .character-pixel {
            width: 140px;
            height: 140px;
            margin: 0 auto 20px;
            background: rgba(44, 44, 46, 0.6);
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .character-pixel img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Character images */
        .character-pixel.tobias {
            background: url('photos/horvath.png') center center / cover no-repeat;
        }

        .character-pixel.vojtech {
            background: url('photos/aloy.png') center center / cover no-repeat;
        }

        .character-pixel.hynek {
            background: url('photos/schiffner.png') center center / cover no-repeat;
        }

        .character-pixel.adam {
            background: url('photos/hojer2.png') center center / cover no-repeat;
        }

        .character-name {
            font-size: 19px;
            color: #FFFFFF;
            margin-bottom: 6px;
            font-weight: 600;
            letter-spacing: -0.3px;
        }

        .character-bonus {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
            margin-bottom: 16px;
            min-height: 38px;
            font-weight: 400;
            line-height: 1.4;
        }

        .character-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 16px;
        }

        .stat-tag {
            background: rgba(44, 44, 46, 0.6);
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .start-button {
            background: var(--primary);
            color: #FFFFFF;
            border: none;
            padding: 16px 48px;
            font-size: 17px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            letter-spacing: -0.2px;
        }

        .start-button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .start-button:active {
            transform: scale(0.98);
        }

        /* ===== IMPROVED GAME INTERFACE ===== */
        .game-container {
            display: none;
            width: 100vw;
            height: 100vh;
            background: transparent;
        }

        .game-interface {
            display: none;
            width: 100%;
            height: 100%;
            padding: 20px;
            gap: 20px;
            flex-direction: column;
        }

        /* Top Bar */
        .game-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 35px;
            background: rgba(28, 28, 30, 0.85);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.05);
            gap: 30px;
            flex-shrink: 0;
        }

        .character-info {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 0 0 auto;
            padding: 8px 16px 8px 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .character-display {
            width: 56px;
            height: 56px;
            background: var(--bg-tertiary);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .character-display.tobias {
            background: url('photos/horvath.png') center center / cover no-repeat;
        }

        .character-display.vojtech {
            background: url('photos/aloy.png') center center / cover no-repeat;
        }

        .character-display.hynek {
            background: url('photos/schiffner.png') center center / cover no-repeat;
        }

        .character-display.adam {
            background: url('photos/hojer2.png') center center / cover no-repeat;
        }

        .character-details h2 {
            color: var(--text-primary);
            margin-bottom: 4px;
            font-size: 17px;
            font-weight: 700;
            letter-spacing: -0.3px;
        }

        .character-class {
            color: rgba(255, 255, 255, 0.5);
            font-size: 13px;
            font-weight: 500;
        }

        .money-display {
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 193, 7, 0.1));
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            flex: 0 0 auto;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .money-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.15) 0%, transparent 70%);
            animation: moneyGlow 3s ease-in-out infinite;
        }

        @keyframes moneyGlow {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        .money-display::after {
            content: '💰';
            position: absolute;
            font-size: 48px;
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.15;
            filter: blur(2px);
        }

        .money-amount {
            font-size: 28px;
            color: #FFD700;
            font-weight: 800;
            text-shadow: 0 2px 8px rgba(255, 215, 0, 0.4), 0 0 20px rgba(255, 215, 0, 0.2);
            position: relative;
            z-index: 1;
            letter-spacing: -0.5px;
        }

        .money-label {
            font-size: 11px;
            color: rgba(255, 215, 0, 0.7);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        .os-progress-display {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 1;
            min-width: 0;
            padding: 10px 20px;
            background: rgba(99, 102, 241, 0.08);
            border-radius: 12px;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .os-progress-text {
            font-size: 13px;
            color: rgba(99, 102, 241, 1);
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(99, 102, 241, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .os-progress-text::before {
            content: '⚙️';
            font-size: 16px;
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .os-progress-bar {
            flex: 1;
            height: 10px;
            background: rgba(99, 102, 241, 0.15);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(99, 102, 241, 0.25);
            min-width: 200px;
            position: relative;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .os-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
        }

        .os-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        .os-progress-display::after {
            content: attr(data-percentage);
            font-size: 13px;
            color: rgba(99, 102, 241, 0.9);
            font-weight: 700;
            white-space: nowrap;
        }

        /* Main Content Area */
        .game-content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            flex: 1;
            min-height: 0;
        }

        /* Left Panel - Stats */
        .stats-panel {
            background: rgba(28, 28, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 28px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .stats-panel h3 {
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: 20px;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-align: center;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .stats-panel h3::before {
            content: '📊';
            margin-right: 10px;
            font-size: 18px;
        }

        .stats-panel h3::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }

        .stats-grid {
            display: grid;
            gap: 14px;
            flex: 1;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: currentColor;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-item:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: currentColor;
            transform: translateX(5px);
        }

        .stat-item:hover::before {
            opacity: 0.8;
        }

        .stat-icon {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .health { color: var(--error); }
        .hunger { color: var(--warning); }
        .thirst { color: var(--primary); }
        .energy { color: var(--success); }
        .mood { color: var(--purple); }

        .health .stat-icon { background: linear-gradient(135deg, rgba(218, 54, 51, 0.25), rgba(218, 54, 51, 0.15)); }
        .hunger .stat-icon { background: linear-gradient(135deg, rgba(210, 153, 34, 0.25), rgba(210, 153, 34, 0.15)); }
        .thirst .stat-icon { background: linear-gradient(135deg, rgba(88, 166, 255, 0.25), rgba(88, 166, 255, 0.15)); }
        .energy .stat-icon { background: linear-gradient(135deg, rgba(63, 185, 80, 0.25), rgba(63, 185, 80, 0.15)); }
        .mood .stat-icon { background: linear-gradient(135deg, rgba(163, 113, 247, 0.25), rgba(163, 113, 247, 0.15)); }

        .stat-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .stat-name {
            font-size: 13px;
            color: var(--text-primary);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-bar {
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .stat-fill {
            height: 100%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 0 10px currentColor;
        }

        .stat-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.3), transparent);
            border-radius: 6px 6px 0 0;
        }

        .health .stat-fill { background: linear-gradient(90deg, #da3633, #ff6b6b); color: #da3633; }
        .hunger .stat-fill { background: linear-gradient(90deg, #d29922, #ffd93d); color: #d29922; }
        .thirst .stat-fill { background: linear-gradient(90deg, #58a6ff, #4dabf7); color: #58a6ff; }
        .energy .stat-fill { background: linear-gradient(90deg, #3fb950, #69db7c); color: #3fb950; }
        .mood .stat-fill { background: linear-gradient(90deg, #a371f7, #cc5de8); color: #a371f7; }

        .stat-value {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
            min-width: 45px;
            text-align: right;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Actions Panel */
        .actions-panel {
            background: rgba(28, 28, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 28px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .actions-panel h3 {
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: 20px;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-align: center;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .actions-panel h3::before {
            content: '🎮';
            margin-right: 10px;
            font-size: 18px;
        }

        .actions-panel h3::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--success), transparent);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 14px;
            flex: 1;
        }

        .action-button {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px 20px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            min-height: 140px;
        }

        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(88, 166, 255, 0.15), transparent);
            transition: left 0.6s ease;
        }

        .action-button:hover::before {
            left: 100%;
        }

        .action-button::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 16px;
            padding: 1px;
            background: linear-gradient(135deg, transparent, rgba(88, 166, 255, 0.5), transparent);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .action-button:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(88, 166, 255, 0.5);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 32px rgba(88, 166, 255, 0.2), 0 0 0 1px rgba(88, 166, 255, 0.3);
        }

        .action-button:hover::after {
            opacity: 1;
        }

        .action-button:active {
            transform: translateY(-2px) scale(0.98);
        }

        .action-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none !important;
            border-color: rgba(255, 255, 255, 0.05);
        }

        .action-button:disabled:hover {
            box-shadow: none;
        }

        .action-icon {
            font-size: 48px;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4));
            transition: transform 0.3s;
        }

        .action-button:hover .action-icon {
            transform: scale(1.1);
        }

        .action-name {
            font-size: 15px;
            font-weight: 800;
            letter-spacing: 1.2px;
            text-transform: uppercase;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .action-description {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
            line-height: 1.4;
            font-weight: 500;
        }

        /* Right Panel - OS Progress */
        .os-panel {
            background: rgba(28, 28, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 28px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .os-panel h3 {
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: 20px;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-align: center;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .os-panel h3::before {
            content: '🚀';
            margin-right: 10px;
            font-size: 18px;
        }

        .os-panel h3::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--purple), transparent);
        }

        .os-milestones {
            display: flex;
            flex-direction: column;
            gap: 14px;
            flex: 1;
        }

        .milestone {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 14px;
            padding: 16px 18px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .milestone::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 3px;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transform: scaleY(0);
            transition: transform 0.3s;
        }

        .milestone:hover::before {
            transform: scaleY(1);
        }

        .milestone:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateX(5px);
        }

        .milestone.completed {
            border-color: rgba(63, 185, 80, 0.4);
            background: rgba(63, 185, 80, 0.08);
        }

        .milestone.completed::before {
            background: var(--success);
            transform: scaleY(1);
        }

        .milestone-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: rgba(99, 102, 241, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            flex-shrink: 0;
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: var(--primary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .milestone.completed .milestone-icon {
            background: linear-gradient(135deg, rgba(63, 185, 80, 0.3), rgba(63, 185, 80, 0.2));
            border-color: rgba(63, 185, 80, 0.5);
            color: var(--success);
            font-size: 16px;
        }

        .milestone-info {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .milestone-name {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 700;
            margin-bottom: 0;
            letter-spacing: 0.3px;
        }

        .milestone-description {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            line-height: 1.4;
            font-weight: 500;
        }

        .milestone-progress {
            font-size: 12px;
            color: rgba(99, 102, 241, 0.9);
            font-weight: 700;
            white-space: nowrap;
            background: rgba(99, 102, 241, 0.15);
            padding: 4px 10px;
            border-radius: 8px;
            text-align: center;
        }

        .milestone.completed .milestone-progress {
            color: var(--success);
            background: rgba(63, 185, 80, 0.15);
        }

        /* Panel Footer Decorations */
        .stats-panel::after,
        .os-panel::after {
            content: '';
            display: block;
            height: 60px;
            margin-top: auto;
            background: linear-gradient(to top, rgba(255, 255, 255, 0.02), transparent);
            border-radius: 0 0 16px 16px;
            pointer-events: none;
        }

        .achievements-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 193, 7, 0.15));
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(255, 215, 0, 0.2);
            z-index: 500;
        }

        .achievements-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 12px 32px rgba(255, 215, 0, 0.3);
            border-color: rgba(255, 215, 0, 0.5);
        }

        .settings-btn {
            position: fixed;
            bottom: 30px;
            left: 100px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(99, 102, 241, 0.15));
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.2);
            z-index: 500;
            animation: rotate 8s linear infinite;
        }

        .settings-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.3);
            border-color: rgba(99, 102, 241, 0.5);
            animation: none;
        }

        /* ===== MODAL WINDOWS ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(10px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 24px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 24px 64px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1);
            animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .coding-modal-content {
            max-width: 1200px !important;
            width: 95% !important;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            color: var(--text-primary);
            font-size: 26px;
            font-weight: 800;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-title::before {
            content: attr(data-icon);
            font-size: 32px;
        }

        .close-button {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 28px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-button:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        /* Work Modal Improvements */
        .work-categories {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .category-button {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .category-button:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .category-button.active {
            border-color: var(--primary);
            background: rgba(88, 166, 255, 0.1);
        }

        .category-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .category-name {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 4px;
            font-weight: 600;
        }

        .category-bonus {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .question-container {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 18px;
            color: var(--text-primary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .options-container {
            display: grid;
            gap: 10px;
        }

        .option-button {
            background: var(--bg-secondary);
            border: 3px solid var(--border);
            border-radius: 12px;
            padding: 18px 20px;
            color: var(--text-primary);
            text-align: left;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 16px;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .option-button::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 5px;
            background: transparent;
            transition: all 0.3s;
        }

        .option-button:hover:not(:disabled) {
            border-color: var(--primary);
            background: rgba(88, 166, 255, 0.08);
            transform: translateX(5px);
        }

        .option-button.correct {
            border-color: var(--success);
            border-width: 4px;
            background: linear-gradient(90deg, rgba(52, 199, 89, 0.2) 0%, rgba(52, 199, 89, 0.05) 100%);
            animation: correctPulse 0.6s ease-out;
            box-shadow: 0 0 20px rgba(52, 199, 89, 0.3), inset 0 0 20px rgba(52, 199, 89, 0.1);
        }

        .option-button.correct::before {
            background: var(--success);
            width: 6px;
            box-shadow: 0 0 10px var(--success);
        }

        .option-button.correct::after {
            content: '✓';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%) scale(0);
            font-size: 28px;
            color: var(--success);
            font-weight: bold;
            animation: checkmarkAppear 0.4s 0.2s forwards;
        }

        .option-button.incorrect {
            border-color: var(--error);
            border-width: 4px;
            background: linear-gradient(90deg, rgba(255, 59, 48, 0.2) 0%, rgba(255, 59, 48, 0.05) 100%);
            animation: incorrectShake 0.5s ease-out;
            box-shadow: 0 0 20px rgba(255, 59, 48, 0.3), inset 0 0 20px rgba(255, 59, 48, 0.1);
        }

        .option-button.incorrect::before {
            background: var(--error);
            width: 6px;
            box-shadow: 0 0 10px var(--error);
        }

        .option-button.incorrect::after {
            content: '✗';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%) scale(0);
            font-size: 28px;
            color: var(--error);
            font-weight: bold;
            animation: crossAppear 0.4s 0.1s forwards;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes checkmarkAppear {
            0% { 
                transform: translateY(-50%) scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% { 
                transform: translateY(-50%) scale(1.2) rotate(0deg);
            }
            100% { 
                transform: translateY(-50%) scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes crossAppear {
            0% { 
                transform: translateY(-50%) scale(0) rotate(180deg);
                opacity: 0;
            }
            50% { 
                transform: translateY(-50%) scale(1.2) rotate(0deg);
            }
            100% { 
                transform: translateY(-50%) scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        /* Enhanced VS Code Style Coding Modal */
        .coding-editor-header {
            background: #252526;
            padding: 8px 20px;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #1e1e1e;
            margin: -30px -30px 0 -30px;
        }

        .editor-tab {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #2d2d2d;
            padding: 6px 14px;
            border-radius: 6px 6px 0 0;
            color: #d4d4d4;
            font-size: 12px;
            font-family: 'Segoe UI', sans-serif;
        }

        .file-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .language-badge {
            background: rgba(88, 166, 255, 0.2);
            color: var(--primary);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .coding-task {
            background: #1e1e1e;
            border-radius: 0 0 8px 8px;
            padding: 0;
            margin: 0 -30px 20px -30px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            border: none;
            overflow: hidden;
        }

        .code-editor {
            background: #1e1e1e;
            padding: 15px 0;
            max-height: 450px;
            overflow-x: auto;
            overflow-y: auto;
            min-height: 200px;
        }

        .code-line {
            margin: 0;
            padding: 4px 0;
            color: #d4d4d4;
            font-size: 13px;
            display: flex;
            align-items: flex-start;
            line-height: 19px;
            position: relative;
            white-space: nowrap;
            min-width: fit-content;
        }

        .code-line:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .line-number {
            color: #858585;
            min-width: 45px;
            text-align: right;
            padding-right: 15px;
            padding-left: 15px;
            font-size: 12px;
            user-select: none;
            flex-shrink: 0;
        }

        .code-content {
            flex: 1;
            padding-right: 20px;
            white-space: pre;
            min-width: 0;
            word-wrap: normal;
            overflow-wrap: normal;
        }

        /* Syntax highlighting */
        .keyword { color: #569cd6; font-weight: 500; }
        .function-name { color: #dcdcaa; }
        .string { color: #ce9178; }
        .comment { color: #6a9955; font-style: italic; }
        .type { color: #4ec9b0; }
        .number { color: #b5cea8; }
        .operator { color: #d4d4d4; }
        .bracket { color: #ffd700; }

        /* Code Options Section */
        .code-options-section {
            background: #1e1e1e;
            padding: 20px 30px;
            margin: 0 -30px;
            border-top: 1px solid #333;
            border-bottom: 1px solid #333;
        }

        .options-label {
            color: #d4d4d4;
            font-size: 13px;
            font-family: 'Montserrat', sans-serif;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .code-options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .code-option {
            background: #252526;
            border: 1px solid #3c3c3c;
            border-radius: 8px;
            padding: 16px;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            word-break: break-word;
            position: relative;
        }

        .code-option:hover {
            background: #2d2d30;
            border-color: #007AFF;
        }

        .code-option.selected {
            background: rgba(0, 122, 255, 0.1);
            border-color: #007AFF;
            box-shadow: 0 0 0 1px #007AFF inset;
        }

        .code-option.correct {
            background: rgba(52, 199, 89, 0.15);
            border-color: #34C759;
            border-width: 2px;
            box-shadow: 0 0 0 1px #34C759 inset, 0 0 15px rgba(52, 199, 89, 0.3);
            animation: codeCorrectPulse 0.6s ease-out;
        }

        .code-option.incorrect {
            background: rgba(255, 59, 48, 0.15);
            border-color: #FF3B30;
            border-width: 2px;
            box-shadow: 0 0 0 1px #FF3B30 inset, 0 0 15px rgba(255, 59, 48, 0.3);
            animation: codeIncorrectShake 0.5s ease-out;
        }

        @keyframes codeCorrectPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        @keyframes codeIncorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .option-letter {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #3c3c3c;
            color: #858585;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.3s;
        }

        .code-option.selected .option-letter {
            background: #007AFF;
            color: #FFFFFF;
        }

        .code-option.correct .option-letter {
            background: #34C759;
            color: #FFFFFF;
        }

        .code-option.correct .option-letter::after {
            content: ' ✓';
            margin-left: 2px;
        }

        .code-option.incorrect .option-letter {
            background: #FF3B30;
            color: #FFFFFF;
        }

        .code-option.incorrect .option-letter::after {
            content: ' ✗';
            margin-left: 2px;
        }

        .code-input-section {
            background: #252526;
            padding: 20px 30px;
            margin: 0 -30px;
        }

        .input-label {
            color: #858585;
            font-size: 12px;
            font-family: 'Segoe UI', sans-serif;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-label::before {
            content: '▶';
            color: var(--primary);
            font-size: 10px;
        }

        .code-input {
            background: #1e1e1e;
            border: 1px solid #3c3c3c;
            border-radius: 4px;
            padding: 10px 14px;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            width: 100%;
            box-sizing: border-box;
            transition: all 0.2s;
            line-height: 19px;
        }

        .code-input:focus {
            border-color: var(--primary);
            outline: none;
            background: #252526;
            box-shadow: 0 0 0 1px var(--primary);
        }
        
        .code-input:hover {
            border-color: #555;
        }

        .code-hint {
            color: #858585;
            font-size: 12px;
            margin-top: 12px;
            font-style: normal;
            background: rgba(88, 166, 255, 0.1);
            padding: 12px 16px;
            border-radius: 6px;
            border-left: 3px solid var(--primary);
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .code-hint::before {
            content: '💡';
            font-style: normal;
            flex-shrink: 0;
        }

        .submit-button {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 20px -30px -30px -30px;
            width: calc(100% + 60px);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Segoe UI', sans-serif;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .submit-button:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
        }

        .submit-button:active {
            transform: translateY(0);
        }

        /* Custom scrollbar for code editor */
        .code-editor::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .code-editor::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        .code-editor::-webkit-scrollbar-thumb {
            background: #424242;
            border-radius: 5px;
        }

        .code-editor::-webkit-scrollbar-thumb:hover {
            background: #4e4e4e;
        }

        .code-editor::-webkit-scrollbar-corner {
            background: #1e1e1e;
        }

        /* Rest Modal */
        .rest-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .rest-option {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .rest-option:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .rest-icon {
            font-size: 32px;
        }

        .rest-name {
            font-size: 16px;
            color: var(--text-primary);
            font-weight: 600;
        }

        .rest-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .rest-cost {
            font-size: 12px;
            color: var(--gold);
            font-weight: 600;
            line-height: 1.4;
        }

        /* ===== NOTIFICATION SYSTEM ===== */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
        }

        .notification {
            background: var(--bg-secondary);
            border-left: 5px solid var(--primary);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { border-left-color: var(--success); }
        .notification.error { border-left-color: var(--error); }
        .notification.warning { border-left-color: var(--warning); }
        .notification.info { border-left-color: var(--primary); }

        .notification-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 5px;
            font-weight: 600;
        }

        .notification-message {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
            flex-shrink: 0;
        }

        /* ===== ACHIEVEMENTS ===== */
        .achievements-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .achievements-button {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 24px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .achievements-button:hover {
            border-color: var(--gold);
            transform: scale(1.1);
        }

        .achievements-button:active {
            transform: scale(0.95);
        }

        /* Combo display */
        .combo-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5000;
            pointer-events: none;
            display: none;
        }

        .combo-text {
            font-size: 72px;
            font-weight: 800;
            background: linear-gradient(45deg, #ff6b6b, #ffd93d, #6bff6b, #6bb0ff);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
            animation: comboAppear 1s ease-out;
        }

        @keyframes comboAppear {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(10deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 0; }
        }

        .achievements-modal {
            display: none;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .achievement-card {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .achievement-card.unlocked {
            border-color: var(--gold);
            background: rgba(227, 179, 65, 0.1);
        }

        .achievement-icon {
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--gold);
        }

        .achievement-name {
            font-size: 16px;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .achievement-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Settings Modal Styles */
        .settings-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .setting-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 24px;
        }

        .setting-section h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
            letter-spacing: 0.5px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-item label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        .setting-select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 8px 16px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .setting-select:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary);
        }

        .setting-toggle {
            width: 48px;
            height: 26px;
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .setting-toggle:checked {
            background: var(--success);
        }

        .setting-toggle::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            top: 3px;
            left: 3px;
            transition: all 0.3s;
        }

        .setting-toggle:checked::before {
            left: 25px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .info-item {
            background: rgba(99, 102, 241, 0.08);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .info-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-value {
            font-size: 18px;
            color: var(--primary);
            font-weight: 700;
        }

        .settings-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 10px;
        }

        .settings-button {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 0.5px;
        }

        .settings-button.success {
            background: var(--success);
            color: white;
        }

        .settings-button.success:hover {
            background: #3fb950;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(63, 185, 80, 0.3);
        }

        .settings-button.danger {
            background: var(--error);
            color: white;
        }

        .settings-button.danger:hover {
            background: #da3633;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(218, 54, 51, 0.3);
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                transform: translateY(20px); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0); 
                opacity: 1; 
            }
        }

        .achievement-notification {
            background: linear-gradient(135deg, #1a1f2e 0%, #2d1810 100%) !important;
            border-left: 5px solid #e3b341 !important;
            box-shadow: 0 10px 40px rgba(227, 179, 65, 0.3) !important;
            animation: achievementPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes achievementPop {
            0% { transform: translateX(400px) scale(0.8); opacity: 0; }
            50% { transform: translateX(-20px) scale(1.05); }
            100% { transform: translateX(0) scale(1); opacity: 1; }
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1400px) {
            .game-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 1200px) {
            .characters-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .work-categories {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .game-header {
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .os-progress-display {
                flex: 1 1 100%;
            }
        }

        @media (max-width: 768px) {
            .game-title {
                font-size: 36px;
            }
            
            .characters-grid {
                grid-template-columns: 1fr;
            }
            
            .game-header {
                grid-template-columns: 1fr;
                gap: 15px;
                text-align: center;
            }
            
            .work-categories {
                grid-template-columns: 1fr;
            }
            
            .rest-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Cosmic Background -->
    <div class="cosmic-background" id="cosmicBackground"></div>
    <div class="hologram-grid"></div>
    <div class="floating-elements" id="floatingElements"></div>

    <!-- Enhanced Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-title">INF<span style="color: #6366f1;">OS</span></div>
        <div class="loading-container">
            <div class="loading-text" id="loadingText">Initializing kernel modules...</div>
            <div class="loading-bar-container">
                <div class="loading-bar" id="loadingBar"></div>
            </div>
            <div class="loading-details">
                <span>Loading core systems</span>
                <span id="loadingPercent">0%</span>
            </div>
        </div>
        <div class="loading-animation">💻</div>
    </div>

    <!-- Character Selection Screen -->
    <div class="character-selection" id="characterSelection">
        <h1 class="game-title">INF<span style="color: #6366f1;">OS</span></h1>
        <div class="game-subtitle">Build Your Operating System from Scratch • Master IT & Economics • Become a Coding Legend</div>
        
        <div class="characters-grid">
            <!-- Tobias Horvart - Databases -->
            <div class="character-card" data-character="tobias">
                <div class="character-pixel tobias"></div>
                <div class="character-name">Tobias Horvarth</div>
                <div class="character-bonus">Database Architect • +20% Database Earnings</div>
                <div class="character-stats">
                    <div class="stat-tag">SQL: 95</div>
                    <div class="stat-tag">NoSQL: 85</div>
                    <div class="stat-tag">OPTIM: 90</div>
                    <div class="stat-tag">BACKUP: 80</div>
                </div>
            </div>
            
            <!-- Vojtech Aloy - Networks -->
            <div class="character-card" data-character="vojtech">
                <div class="character-pixel vojtech"></div>
                <div class="character-name">Vojtech Aloy</div>
                <div class="character-bonus">Network Specialist • +20% Network Earnings</div>
                <div class="character-stats">
                    <div class="stat-tag">TCP/IP: 90</div>
                    <div class="stat-tag">SECURITY: 85</div>
                    <div class="stat-tag">ROUTING: 88</div>
                    <div class="stat-tag">PROTO: 87</div>
                </div>
            </div>
            
            <!-- Hynek Schiffner - Hardware -->
            <div class="character-card" data-character="hynek">
                <div class="character-pixel hynek"></div>
                <div class="character-name">Hynek Schiffner</div>
                <div class="character-bonus">Hardware Engineer • +20% Hardware Earnings</div>
                <div class="character-stats">
                    <div class="stat-tag">CPU: 92</div>
                    <div class="stat-tag">MEMORY: 88</div>
                    <div class="stat-tag">IO: 85</div>
                    <div class="stat-tag">ARCH: 90</div>
                </div>
            </div>
            
            <!-- Adam Hojer - Programming -->
            <div class="character-card" data-character="adam">
                <div class="character-pixel adam"></div>
                <div class="character-name">Adam Hojer</div>
                <div class="character-bonus">Programming Guru • +50% Coding Progress</div>
                <div class="character-stats">
                    <div class="stat-tag">C/C++: 95</div>
                    <div class="stat-tag">ALGO: 92</div>
                    <div class="stat-tag">DEBUG: 88</div>
                    <div class="stat-tag">OPTIM: 90</div>
                </div>
            </div>
        </div>
        
        <button class="start-button" id="startButton">LAUNCH DEVELOPMENT</button>
    </div>

    <!-- Improved Game Interface -->
    <div class="game-container" id="gameContainer">
        <div class="game-interface" id="gameInterface">
            <!-- Top Header -->
            <div class="game-header">
                <div class="character-info">
                    <div class="character-display" id="currentCharacterDisplay"></div>
                    <div class="character-details">
                        <h2 id="characterName">Select Character</h2>
                        <div class="character-class" id="characterClass">Developer</div>
                    </div>
                </div>
                
                <div class="money-display">
                    <div class="money-amount">$<span id="money">0</span></div>
                </div>
                
                <div class="os-progress-display" data-percentage="0% COMPLETE">
                    <div class="os-progress-text">OS Progress</div>
                    <div class="os-progress-bar">
                        <div class="os-progress-fill" id="osProgressBar"></div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="game-content">
                <!-- Left Panel - Stats -->
                <div class="stats-panel">
                    <h3>VITAL STATISTICS</h3>
                    <div class="stats-grid">
                        <div class="stat-item health">
                            <div class="stat-icon">❤️</div>
                            <div class="stat-info">
                                <div class="stat-name">HEALTH</div>
                                <div class="stat-bar">
                                    <div class="stat-fill" id="healthBar" style="width: 100%"></div>
                                </div>
                            </div>
                            <div class="stat-value" id="healthValue">100%</div>
                        </div>
                        
                        <div class="stat-item hunger">
                            <div class="stat-icon">🍗</div>
                            <div class="stat-info">
                                <div class="stat-name">HUNGER</div>
                                <div class="stat-bar">
                                    <div class="stat-fill" id="hungerBar" style="width: 100%"></div>
                                </div>
                            </div>
                            <div class="stat-value" id="hungerValue">100%</div>
                        </div>
                        
                        <div class="stat-item thirst">
                            <div class="stat-icon">💧</div>
                            <div class="stat-info">
                                <div class="stat-name">THIRST</div>
                                <div class="stat-bar">
                                    <div class="stat-fill" id="thirstBar" style="width: 100%"></div>
                                </div>
                            </div>
                            <div class="stat-value" id="thirstValue">100%</div>
                        </div>
                        
                        <div class="stat-item energy">
                            <div class="stat-icon">⚡</div>
                            <div class="stat-info">
                                <div class="stat-name">ENERGY</div>
                                <div class="stat-bar">
                                    <div class="stat-fill" id="energyBar" style="width: 100%"></div>
                                </div>
                            </div>
                            <div class="stat-value" id="energyValue">100%</div>
                        </div>
                        
                        <div class="stat-item mood">
                            <div class="stat-icon">😊</div>
                            <div class="stat-info">
                                <div class="stat-name">MOOD</div>
                                <div class="stat-bar">
                                    <div class="stat-fill" id="moodBar" style="width: 100%"></div>
                                </div>
                            </div>
                            <div class="stat-value" id="moodValue">100%</div>
                        </div>
                    </div>
                </div>

                <!-- Middle Panel - Actions -->
                <div class="actions-panel">
                    <h3>Actions</h3>
                    <div class="actions-grid">
                        <button class="action-button" id="workButton">
                            <div class="action-icon">💼</div>
                            <div class="action-name">FREELANCE WORK</div>
                            <div class="action-description">Answer questions to earn money</div>
                        </button>
                        
                        <button class="action-button" id="codeButton">
                            <div class="action-icon">💻</div>
                            <div class="action-name">DEVELOP OS</div>
                            <div class="action-description">Write code to build your system</div>
                        </button>
                        
                        <button class="action-button" id="restButton">
                            <div class="action-icon">😴</div>
                            <div class="action-name">REST & RECOVER</div>
                            <div class="action-description">Manage your basic needs</div>
                        </button>
                    </div>
                </div>

                <!-- Right Panel - OS Progress -->
                <div class="os-panel">
                    <h3>OS DEVELOPMENT ROADMAP</h3>
                    <div class="os-milestones" id="osMilestones">
                        <div class="milestone" id="milestone-kernel">
                            <div class="milestone-icon">1</div>
                            <div class="milestone-info">
                                <div class="milestone-name">Kernel Development</div>
                                <div class="milestone-description">Core system operations</div>
                            </div>
                            <div class="milestone-progress">0%</div>
                        </div>
                        
                        <div class="milestone" id="milestone-memory">
                            <div class="milestone-icon">2</div>
                            <div class="milestone-info">
                                <div class="milestone-name">Memory Management</div>
                                <div class="milestone-description">RAM allocation and paging</div>
                            </div>
                            <div class="milestone-progress">0%</div>
                        </div>
                        
                        <div class="milestone" id="milestone-filesystem">
                            <div class="milestone-icon">3</div>
                            <div class="milestone-info">
                                <div class="milestone-name">File System</div>
                                <div class="milestone-description">Storage and data management</div>
                            </div>
                            <div class="milestone-progress">0%</div>
                        </div>
                        
                        <div class="milestone" id="milestone-drivers">
                            <div class="milestone-icon">4</div>
                            <div class="milestone-info">
                                <div class="milestone-name">Device Drivers</div>
                                <div class="milestone-description">Hardware communication</div>
                            </div>
                            <div class="milestone-progress">0%</div>
                        </div>
                        
                        <div class="milestone" id="milestone-network">
                            <div class="milestone-icon">5</div>
                            <div class="milestone-info">
                                <div class="milestone-name">Networking Stack</div>
                                <div class="milestone-description">Internet and local connectivity</div>
                            </div>
                            <div class="milestone-progress">0%</div>
                        </div>
                        
                        <div class="milestone" id="milestone-ui">
                            <div class="milestone-icon">6</div>
                            <div class="milestone-info">
                                <div class="milestone-name">User Interface</div>
                                <div class="milestone-description">GUI and user experience</div>
                            </div>
                            <div class="milestone-progress">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Floating Action Buttons -->
            <div class="achievements-btn" id="achievementsBtn" title="Achievements">🏆</div>
            <div class="settings-btn" id="settingsBtn" title="Settings">⚙️</div>
        </div>
    </div>

    <!-- Work Modal -->
    <div class="modal" id="workModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" data-icon="💼">Freelance Development Work</h2>
                <button class="close-button" id="closeWorkModal">&times;</button>
            </div>
            
            <div class="work-categories">
                <div class="category-button active" data-category="databases">
                    <div class="category-icon">🗄️</div>
                    <div class="category-name">Databases</div>
                    <div class="category-bonus" id="databasesBonus">+$15-25</div>
                </div>
                <div class="category-button" data-category="networks">
                    <div class="category-icon">🌐</div>
                    <div class="category-name">Networks</div>
                    <div class="category-bonus" id="networksBonus">+$15-25</div>
                </div>
                <div class="category-button" data-category="hardware">
                    <div class="category-icon">🔧</div>
                    <div class="category-name">Hardware</div>
                    <div class="category-bonus" id="hardwareBonus">+$15-25</div>
                </div>
                <div class="category-button" data-category="economics">
                    <div class="category-icon">📈</div>
                    <div class="category-name">Economics</div>
                    <div class="category-bonus" id="economicsBonus">+$15-25</div>
                </div>
            </div>
            
            <div class="question-container">
                <div class="question-text" id="questionText">Select a category to start working...</div>
                <div class="options-container" id="optionsContainer"></div>
            </div>
        </div>
    </div>

    <!-- Coding Modal -->
    <div class="modal" id="codingModal">
        <div class="modal-content coding-modal-content">
            <div class="modal-header" style="border-bottom: none; padding-bottom: 0;">
                <h2 class="modal-title" data-icon="💻">OS Development - Code Editor</h2>
                <button class="close-button" id="closeCodingModal">&times;</button>
            </div>
            
            <div class="coding-container">
                <!-- VS Code Style Editor Header -->
                <div class="coding-editor-header">
                    <div class="editor-tab">
                        <div class="file-icon">📄</div>
                        <span id="fileName">main.c</span>
                        <div class="language-badge" id="languageBadge">C</div>
                    </div>
                </div>
                
                <!-- Code Editor Area -->
                <div class="coding-task" id="codingTask">
                    <div class="code-editor" id="codeEditor">
                        <!-- Code will be inserted here by JavaScript -->
                    </div>
                </div>
                
                <!-- Options Section -->
                <div class="code-options-section">
                    <div class="options-label">💡 Choose the correct code and type it below:</div>
                    <div class="code-options-grid" id="codeOptionsGrid">
                        <!-- Options will be inserted here by JavaScript -->
                    </div>
                </div>
                
                <!-- Input Section -->
                <div class="code-input-section">
                    <div class="input-label">Type your answer here:</div>
                    <input type="text" class="code-input" id="codeInput" placeholder="Type the correct code here..." autocomplete="off" spellcheck="false">
                    
                    <div class="code-hint" id="codeHint">
                        <span id="hintText">Hint: Complete the code above</span>
                    </div>
                </div>
                
                <button class="submit-button" id="submitCode">▶ Compile & Run</button>
            </div>
        </div>
    </div>

    <!-- Rest Modal -->
    <div class="modal" id="restModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" data-icon="😴">Rest & Recovery</h2>
                <button class="close-button" id="closeRestModal">&times;</button>
            </div>
            
            <div class="rest-options">
                <div class="rest-option" data-action="sleep">
                    <div class="rest-icon">😴</div>
                    <div class="rest-name">Sleep</div>
                    <div class="rest-description">Rest when tired (Energy < 70%)<br>⚠️ Makes you hungry & thirsty!</div>
                    <div class="rest-cost">+60 Energy, +10 Mood<br>-20 Hunger, -25 Thirst</div>
                </div>
                
                <div class="rest-option" data-action="eat">
                    <div class="rest-icon">🍗</div>
                    <div class="rest-name">Eat Food</div>
                    <div class="rest-description">Satisfy hunger (when < 80%)<br>⚠️ Makes you thirsty!</div>
                    <div class="rest-cost">-$25 • +45 Hunger, +8 Mood<br>-10 Thirst</div>
                </div>
                
                <div class="rest-option" data-action="drink">
                    <div class="rest-icon">💧</div>
                    <div class="rest-name">Drink Water</div>
                    <div class="rest-description">Quench thirst (when < 85%)<br>Slightly reduces hunger</div>
                    <div class="rest-cost">-$15 • +40 Thirst, +5 Mood<br>-5 Hunger</div>
                </div>
                
                <div class="rest-option" data-action="walk">
                    <div class="rest-icon">🚶</div>
                    <div class="rest-name">Take a Walk</div>
                    <div class="rest-description">Boost mood (when < 85%)<br>⚠️ Uses energy & resources!</div>
                    <div class="rest-cost">+30 Mood<br>-12 Energy, -8 Hunger, -12 Thirst</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Achievements Modal -->
    <div class="modal achievements-modal" id="achievementsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" data-icon="🏆">Achievements</h2>
                <button class="close-button" id="closeAchievementsModal">&times;</button>
            </div>
            
            <div class="achievements-grid" id="achievementsGrid">
                <!-- Achievements will be dynamically added here -->
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal settings-modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" data-icon="⚙️">Settings</h2>
                <button class="close-button" id="closeSettingsModal">&times;</button>
            </div>
            
            <div class="settings-content">
                <div class="setting-section">
                    <h3>🎮 Game Settings</h3>
                    <div class="setting-item">
                        <label>Difficulty Mode</label>
                        <select class="setting-select" id="difficultySelect">
                            <option value="easy">Easy - Relaxed gameplay</option>
                            <option value="normal" selected>Normal - Balanced challenge</option>
                            <option value="hard">Hard - Intense survival</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Auto-save</label>
                        <input type="checkbox" class="setting-toggle" id="autoSaveToggle" checked>
                    </div>
                </div>

                <div class="setting-section">
                    <h3>🎨 Display Settings</h3>
                    <div class="setting-item">
                        <label>Show Notifications</label>
                        <input type="checkbox" class="setting-toggle" id="notificationsToggle" checked>
                    </div>
                    <div class="setting-item">
                        <label>Show Stats Percentage</label>
                        <input type="checkbox" class="setting-toggle" id="statsPercentageToggle" checked>
                    </div>
                </div>

                <div class="setting-section">
                    <h3>📊 Game Info</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">1.0.0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Playtime</div>
                            <div class="info-value" id="playtimeValue">0 minutes</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Money Earned</div>
                            <div class="info-value" id="totalMoneyValue">$0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Tasks Completed</div>
                            <div class="info-value" id="tasksCompletedValue">0</div>
                        </div>
                    </div>
                </div>

                <div class="settings-footer">
                    <button class="settings-button danger" onclick="game.resetGame()">🔄 Reset Game</button>
                    <button class="settings-button success" onclick="game.closeModal('settingsModal')">✓ Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer">
        <!-- Notifications will be dynamically added here -->
    </div>

    <!-- Combo Display -->
    <div class="combo-display" id="comboDisplay">
        <div class="combo-text" id="comboText"></div>
    </div>

    <script>
        // ===== ENHANCED GAME ENGINE =====
        class OSTycoonGame {
            constructor() {
                this.gameState = {
                    character: null,
                    money: 0,
                    health: 100,
                    hunger: 100,
                    thirst: 100,
                    energy: 100,
                    mood: 100,
                    osProgress: 0,
                    gameTime: 0,
                    selectedCharacter: null,
                    achievements: [],
                    completedQuestions: 0,
                    correctAnswers: 0,
                    codingTasksCompleted: 0,
                    correctStreak: 0,
                    milestones: {
                        kernel: 0,
                        memory: 0,
                        filesystem: 0,
                        drivers: 0,
                        network: 0,
                        ui: 0
                    }
                };

                this.warningShownHunger = false;
                this.warningShownThirst = false;

                this.questions = this.initializeQuestions();
                this.codingTasks = this.initializeCodingTasks();
                this.achievements = this.initializeAchievements();
                this.currentQuestion = null;
                this.currentCodingTask = null;
                this.currentCategory = 'databases';
                this.gameInterval = null;
                this.notificationId = 0;
                this.isSubmitting = false; // Prevent multiple code submissions
                this.rewardAlreadyGiven = false; // Prevent duplicate rewards
                this.isAnswering = false; // Prevent multiple answer clicks in freelance work
                this.workModalTimeout = null; // Store timeout ID for auto-closing work modal
                
                this.initializeGame();
            }

            initializeGame() {
                this.setupEventListeners();
                this.showEnhancedLoadingScreen();
            }

            saveGameState() {
                try {
                    localStorage.setItem('ostycoon_save', JSON.stringify(this.gameState));
                } catch (e) {
                    console.error('Failed to save game:', e);
                }
            }

            loadGameState() {
                try {
                    const saved = localStorage.getItem('ostycoon_save');
                    if (saved) {
                        const data = JSON.parse(saved);
                        if (data.osProgress < 100) {
                            Object.assign(this.gameState, data);
                        }
                    }
                } catch (e) {
                    console.error('Failed to load game:', e);
                }
            }

            resetGame() {
                if (confirm('Are you sure you want to reset all progress?')) {
                    localStorage.removeItem('ostycoon_save');
                    location.reload();
                }
            }

            showEnhancedLoadingScreen() {
                const loadingBar = document.getElementById('loadingBar');
                const loadingText = document.getElementById('loadingText');
                const loadingPercent = document.getElementById('loadingPercent');
                
                const steps = [
                    { text: 'Initializing kernel modules...', duration: 800 },
                    { text: 'Loading memory management...', duration: 700 },
                    { text: 'Setting up file systems...', duration: 900 },
                    { text: 'Configuring network stack...', duration: 600 },
                    { text: 'Compiling device drivers...', duration: 850 },
                    { text: 'Initializing user interface...', duration: 750 },
                    { text: 'Starting development environment...', duration: 500 }
                ];

                let progress = 0;
                let currentStep = 0;

                const loadStep = () => {
                    if (currentStep < steps.length) {
                        const step = steps[currentStep];
                        loadingText.textContent = step.text;
                        
                        const interval = setInterval(() => {
                            progress += Math.random() * 5;
                            if (progress >= ((currentStep + 1) * (100 / steps.length))) {
                                progress = ((currentStep + 1) * (100 / steps.length));
                                clearInterval(interval);
                                currentStep++;
                                setTimeout(loadStep, 100);
                            }
                            
                            loadingBar.style.width = `${progress}%`;
                            loadingPercent.textContent = `${Math.floor(progress)}%`;
                        }, step.duration / 30);
                    } else {
                        loadingBar.style.width = '100%';
                        loadingPercent.textContent = '100%';
                        loadingText.textContent = 'Ready to develop!';
                        
                        setTimeout(() => {
                            document.getElementById('loadingScreen').style.display = 'none';
                            document.getElementById('characterSelection').style.display = 'flex';
                        }, 1000);
                    }
                };

                loadStep();
            }

            setupEventListeners() {
                // Character selection
                document.querySelectorAll('.character-card').forEach(card => {
                    card.addEventListener('click', () => this.selectCharacter(card));
                });

                document.getElementById('startButton').addEventListener('click', () => this.startGame());

                // Action buttons
                document.getElementById('workButton').addEventListener('click', () => this.showWorkModal());
                document.getElementById('codeButton').addEventListener('click', () => this.showCodingModal());
                document.getElementById('restButton').addEventListener('click', () => this.showRestModal());

                // Modal close buttons
                document.getElementById('closeWorkModal').addEventListener('click', () => this.closeModal('workModal'));
                document.getElementById('closeCodingModal').addEventListener('click', () => this.closeModal('codingModal'));
                document.getElementById('closeRestModal').addEventListener('click', () => this.closeModal('restModal'));
                document.getElementById('closeAchievementsModal').addEventListener('click', () => this.closeModal('achievementsModal'));
                document.getElementById('closeSettingsModal').addEventListener('click', () => this.closeModal('settingsModal'));

                // Floating buttons
                document.getElementById('achievementsBtn').addEventListener('click', () => this.showAchievementsModal());
                document.getElementById('settingsBtn').addEventListener('click', () => this.showSettingsModal());

                // Work category selection
                document.querySelectorAll('.category-button').forEach(button => {
                    button.addEventListener('click', () => this.selectCategory(button));
                });

                // Rest actions
                document.querySelectorAll('.rest-option').forEach(option => {
                    option.addEventListener('click', () => this.handleRestAction(option.dataset.action));
                });

                // Code submission
                document.getElementById('submitCode').addEventListener('click', () => this.submitCode());
                document.getElementById('codeInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.submitCode();
                });

                // Close modals on outside click
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) this.closeModal(modal.id);
                    });
                });
            }

            selectCharacter(card) {
                document.querySelectorAll('.character-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                this.gameState.selectedCharacter = card.dataset.character;
            }

            startGame() {
                if (!this.gameState.selectedCharacter) {
                    this.showNotification('Please select a character first!', 'error');
                    return;
                }

                this.gameState.character = this.gameState.selectedCharacter;
                this.gameState.money = 0; // Начальный баланс 0$
                document.getElementById('characterSelection').style.display = 'none';
                document.getElementById('gameContainer').style.display = 'block';
                document.getElementById('gameInterface').style.display = 'flex';

                this.updateUI();
                this.startGameLoop();

                this.showNotification(`Welcome, ${this.getCharacterName()}! Begin your OS development journey.`, 'success');
            }

            startGameLoop() {
                this.gameInterval = setInterval(() => {
                    this.decreaseStats();
                    this.checkAchievements();
                    this.gameState.gameTime++;
                    
                    // Автосохранение каждые 15 секунд
                    if (this.gameState.gameTime % 5 === 0) {
                        this.saveGameState();
                    }
                }, 3000);
            }

            decreaseStats() {
                // Более сбалансированное падение статов
                this.gameState.hunger = Math.max(0, this.gameState.hunger - 0.4);
                this.gameState.thirst = Math.max(0, this.gameState.thirst - 0.6);
                this.gameState.energy = Math.max(0, this.gameState.energy - 0.25);
                this.gameState.mood = Math.max(0, this.gameState.mood - 0.15);

                // Health penalties for critical needs
                if (this.gameState.hunger < 20 || this.gameState.thirst < 20) {
                    this.gameState.health = Math.max(0, this.gameState.health - 0.3);
                    this.showWarningIfNeeded();
                }

                if (this.gameState.energy < 10) {
                    this.gameState.mood = Math.max(0, this.gameState.mood - 0.5);
                }

                // Update milestone progress based on OS progress
                this.updateMilestones();

                // Game over condition
                if (this.gameState.health <= 0) {
                    this.gameOver();
                }

                this.updateUI();
            }

            showWarningIfNeeded() {
                if (this.gameState.hunger < 15 && !this.warningShownHunger) {
                    this.showNotification('⚠️ Critical hunger level! Your health is decreasing!', 'warning');
                    this.warningShownHunger = true;
                    setTimeout(() => this.warningShownHunger = false, 30000);
                }
                if (this.gameState.thirst < 15 && !this.warningShownThirst) {
                    this.showNotification('⚠️ Critical thirst level! Your health is decreasing!', 'warning');
                    this.warningShownThirst = true;
                    setTimeout(() => this.warningShownThirst = false, 30000);
                }
            }

            showCombo(streak) {
                if (streak < 5) return;
                
                const comboDisplay = document.getElementById('comboDisplay');
                const comboText = document.getElementById('comboText');
                
                let message = '';
                if (streak === 5) message = '🔥 COMBO x5!';
                else if (streak === 10) message = '🔥🔥 AMAZING x10!';
                else if (streak === 15) message = '🔥🔥🔥 LEGENDARY x15!';
                else if (streak >= 20) message = `🔥🔥🔥🔥 GODLIKE x${streak}!`;
                else message = `🔥 COMBO x${streak}!`;
                
                comboText.textContent = message;
                comboDisplay.style.display = 'block';
                
                setTimeout(() => {
                    comboDisplay.style.display = 'none';
                }, 1000);
            }

            updateMilestones() {
                const totalProgress = this.gameState.osProgress;
                const milestones = this.gameState.milestones;
                
                // Более реалистичное распределение прогресса по этапам
                if (totalProgress < 20) {
                    // Начальная фаза - Kernel
                    milestones.kernel = Math.min(100, totalProgress * 5);
                } else if (totalProgress < 35) {
                    milestones.kernel = 100;
                    milestones.memory = Math.min(100, (totalProgress - 20) * 6.67);
                } else if (totalProgress < 50) {
                    milestones.kernel = 100;
                    milestones.memory = 100;
                    milestones.filesystem = Math.min(100, (totalProgress - 35) * 6.67);
                } else if (totalProgress < 65) {
                    milestones.kernel = 100;
                    milestones.memory = 100;
                    milestones.filesystem = 100;
                    milestones.drivers = Math.min(100, (totalProgress - 50) * 6.67);
                } else if (totalProgress < 85) {
                    milestones.kernel = 100;
                    milestones.memory = 100;
                    milestones.filesystem = 100;
                    milestones.drivers = 100;
                    milestones.network = Math.min(100, (totalProgress - 65) * 5);
                } else {
                    milestones.kernel = 100;
                    milestones.memory = 100;
                    milestones.filesystem = 100;
                    milestones.drivers = 100;
                    milestones.network = 100;
                    milestones.ui = Math.min(100, (totalProgress - 85) * 6.67);
                }

                // Update UI
                Object.keys(milestones).forEach(milestone => {
                    const element = document.getElementById(`milestone-${milestone}`);
                    if (element) {
                        const progress = milestones[milestone];
                        const progressElement = element.querySelector('.milestone-progress');
                        if (progressElement) progressElement.textContent = `${Math.floor(progress)}%`;
                        
                        if (progress >= 100 && !element.classList.contains('completed')) {
                            element.classList.add('completed');
                            element.querySelector('.milestone-icon').textContent = '✓';
                            this.showNotification(`✅ Milestone Complete: ${this.getMilestoneName(milestone)}`, 'success');
                        }
                    }
                });
            }

            getMilestoneName(milestone) {
                const names = {
                    kernel: 'Kernel Development',
                    memory: 'Memory Management',
                    filesystem: 'File System',
                    drivers: 'Device Drivers',
                    network: 'Networking Stack',
                    ui: 'User Interface'
                };
                return names[milestone] || milestone;
            }

            gameOver() {
                clearInterval(this.gameInterval);
                this.showNotification('Game Over! Your health reached zero. Refresh to restart.', 'error');
                document.querySelectorAll('.action-button').forEach(btn => btn.disabled = true);
            }

            updateUI() {
                // Update money
                document.getElementById('money').textContent = Math.floor(this.gameState.money);

                // Update progress bars
                this.updateProgressBar('health', this.gameState.health);
                this.updateProgressBar('hunger', this.gameState.hunger);
                this.updateProgressBar('thirst', this.gameState.thirst);
                this.updateProgressBar('energy', this.gameState.energy);
                this.updateProgressBar('mood', this.gameState.mood);

                // Update OS progress
                const osProgressDisplay = document.querySelector('.os-progress-display');
                osProgressDisplay.setAttribute('data-percentage', `${Math.floor(this.gameState.osProgress)}% COMPLETE`);
                document.getElementById('osProgressBar').style.width = `${this.gameState.osProgress}%`;

                // Update character display
                if (this.gameState.character) {
                    document.getElementById('currentCharacterDisplay').className = `character-display ${this.gameState.character}`;
                    document.getElementById('characterName').textContent = this.getCharacterName();
                    document.getElementById('characterClass').textContent = this.getCharacterClass();
                }

                // Update action button states
                document.getElementById('workButton').disabled = this.gameState.energy < 10;
                document.getElementById('codeButton').disabled = this.gameState.energy < 15;
            }

            updateProgressBar(stat, value) {
                const bar = document.getElementById(`${stat}Bar`);
                const valueElement = document.getElementById(`${stat}Value`);
                
                if (bar) bar.style.width = `${value}%`;
                if (valueElement) valueElement.textContent = `${Math.floor(value)}%`;
            }

            showWorkModal() {
                if (this.gameState.energy < 10) {
                    this.showNotification("Too tired to work! Get some rest.", 'error');
                    return;
                }

                this.currentCategory = 'databases';
                this.updateCategoryBonuses();
                this.loadRandomQuestion();
                this.showModal('workModal');

                // Deduct energy for working
                this.gameState.energy = Math.max(0, this.gameState.energy - 8);
                this.updateUI();
            }

            updateCategoryBonuses() {
                const baseBonus = '+$10-20';
                const boostedBonus = '+$12-24'; // +20% бонус
                
                const bonuses = {
                    databases: this.gameState.character === 'tobias' ? boostedBonus : baseBonus,
                    networks: this.gameState.character === 'vojtech' ? boostedBonus : baseBonus,
                    hardware: this.gameState.character === 'hynek' ? boostedBonus : baseBonus,
                    economics: baseBonus // No specific character bonus for economics
                };

                document.getElementById('databasesBonus').textContent = bonuses.databases;
                document.getElementById('networksBonus').textContent = bonuses.networks;
                document.getElementById('hardwareBonus').textContent = bonuses.hardware;
                document.getElementById('economicsBonus').textContent = bonuses.economics;
            }

            selectCategory(button) {
                document.querySelectorAll('.category-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                this.currentCategory = button.dataset.category;
                this.loadRandomQuestion();
            }

            loadRandomQuestion() {
                const categoryQuestions = this.questions[this.currentCategory];
                if (!categoryQuestions || categoryQuestions.length === 0) return;

                this.currentQuestion = categoryQuestions[Math.floor(Math.random() * categoryQuestions.length)];
                this.displayQuestion(this.currentQuestion);
            }

            displayQuestion(question) {
                document.getElementById('questionText').textContent = question.question;
                const optionsContainer = document.getElementById('optionsContainer');
                optionsContainer.innerHTML = '';

                // Create array of options with their original indices
                const shuffledOptions = question.options.map((option, index) => ({
                    text: option,
                    originalIndex: index,
                    isCorrect: index === question.correct
                }));

                // Shuffle the options array using Fisher-Yates algorithm
                for (let i = shuffledOptions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffledOptions[i], shuffledOptions[j]] = [shuffledOptions[j], shuffledOptions[i]];
                }

                // Display shuffled options
                shuffledOptions.forEach((option) => {
                    const button = document.createElement('button');
                    button.className = 'option-button';
                    button.textContent = option.text;
                    // Store if this is the correct answer as data attribute
                    button.dataset.isCorrect = option.isCorrect;
                    button.dataset.originalIndex = option.originalIndex;
                    // Pass the button element itself to handler
                    button.onclick = () => this.handleAnswer(button, question.correct, question.explanation);
                    optionsContainer.appendChild(button);
                });
            }

            handleAnswer(clickedButton, correctIndex, explanation) {
                // Prevent multiple clicks - if already answering, ignore
                if (this.isAnswering) {
                    return;
                }
                
                // Set flag to prevent duplicate clicks
                this.isAnswering = true;
                
                const options = document.querySelectorAll('.option-button');
                
                // Disable all buttons to prevent further clicks
                options.forEach(option => {
                    option.disabled = true;
                    option.style.cursor = 'not-allowed';
                });

                this.gameState.completedQuestions++;

                // Check if clicked button is correct
                const isCorrect = clickedButton.dataset.isCorrect === 'true';

                if (isCorrect) {
                    // User selected correct answer
                    clickedButton.classList.add('correct');
                    clickedButton.style.opacity = '1';
                    
                    this.gameState.correctStreak++;
                    this.handleCorrectAnswer();
                    
                    // Показываем комбо
                    if (this.gameState.correctStreak >= 5) {
                        this.showCombo(this.gameState.correctStreak);
                    }
                    
                    let message = `✓ Correct! ${explanation}`;
                    if (this.gameState.correctStreak >= 5) {
                        message += ` 🔥 ${this.gameState.correctStreak} streak!`;
                    }
                    this.showNotification(message, 'success');
                } else {
                    // User selected wrong answer
                    clickedButton.classList.add('incorrect');
                    clickedButton.style.opacity = '1';
                    
                    // Find and highlight the correct answer
                    options.forEach(option => {
                        if (option.dataset.isCorrect === 'true') {
                            option.classList.add('correct');
                            option.style.opacity = '1';
                        } else if (option !== clickedButton) {
                            option.style.opacity = '0.5';
                        }
                    });
                    
                    this.gameState.correctStreak = 0;
                    this.handleIncorrectAnswer();
                    this.showNotification(`✗ Incorrect. ${explanation}`, 'error');
                }

                // Clear any existing timeout before setting a new one
                if (this.workModalTimeout) {
                    clearTimeout(this.workModalTimeout);
                }

                // Set new timeout and save its ID
                this.workModalTimeout = setTimeout(() => {
                    this.closeModal('workModal');
                    this.loadRandomQuestion();
                    // Reset flag after modal closes
                    this.isAnswering = false;
                    this.workModalTimeout = null;
                }, 2500);
            }

            handleCorrectAnswer() {
                let baseEarnings = 10 + Math.floor(Math.random() * 11); // $10-20
                
                // Character bonuses +20%
                if ((this.gameState.character === 'tobias' && this.currentCategory === 'databases') ||
                    (this.gameState.character === 'vojtech' && this.currentCategory === 'networks') ||
                    (this.gameState.character === 'hynek' && this.currentCategory === 'hardware')) {
                    baseEarnings = Math.floor(baseEarnings * 1.2);
                }

                // Combo bonus!
                if (this.gameState.correctStreak >= 5) {
                    const comboMultiplier = 1 + (this.gameState.correctStreak * 0.05);
                    baseEarnings = Math.floor(baseEarnings * comboMultiplier);
                }

                this.gameState.money += baseEarnings;
                this.gameState.correctAnswers++;
                this.gameState.mood = Math.min(100, this.gameState.mood + 3);
                // Убрали прогресс ОС за ответы на вопросы!
            }

            handleIncorrectAnswer() {
                this.gameState.money = Math.max(0, this.gameState.money - 5);
                this.gameState.mood = Math.max(0, this.gameState.mood - 5);
            }

            showCodingModal() {
                if (this.gameState.energy < 15) {
                    this.showNotification("Too tired to code! Get some rest.", 'error');
                    return;
                }

                // Reset flags for new task
                this.isSubmitting = false;
                this.rewardAlreadyGiven = false;

                // Load random coding task BEFORE showing modal
                this.loadRandomCodingTask();
                
                // Make sure modal is properly displayed
                this.showModal('codingModal');
                
                // Focus on input after a short delay to ensure modal is visible
                setTimeout(() => {
                    const codeInput = document.getElementById('codeInput');
                    if (codeInput) {
                        codeInput.focus();
                    }
                }, 100);

                // Deduct energy for coding
                this.gameState.energy = Math.max(0, this.gameState.energy - 12);
                this.updateUI();
            }

            loadRandomCodingTask() {
                if (!this.codingTasks || this.codingTasks.length === 0) {
                    console.error('No coding tasks available!');
                    this.showNotification('No coding tasks available!', 'error');
                    return;
                }
                
                this.currentCodingTask = this.codingTasks[Math.floor(Math.random() * this.codingTasks.length)];
                console.log('Loaded coding task:', this.currentCodingTask);
                this.displayCodingTask(this.currentCodingTask);
            }

            displayCodingTask(task) {
                const codeEditor = document.getElementById('codeEditor');
                if (!codeEditor) {
                    console.error('Code editor element not found!');
                    return;
                }
                
                // Update language badge and file name
                const languageMap = {
                    'c': { name: 'C', icon: '📄', file: 'main.c' },
                    'python': { name: 'Python', icon: '🐍', file: 'script.py' },
                    'javascript': { name: 'JavaScript', icon: '📜', file: 'app.js' },
                    'java': { name: 'Java', icon: '☕', file: 'Main.java' },
                    'asm': { name: 'Assembly', icon: '⚙️', file: 'boot.asm' }
                };
                
                const langInfo = languageMap[task.language] || { name: task.language.toUpperCase(), icon: '📄', file: 'code.txt' };
                
                document.getElementById('languageBadge').textContent = langInfo.name;
                document.getElementById('fileName').textContent = langInfo.file;
                
                // Build code with syntax highlighting
                let htmlContent = '';
                
                task.code.forEach((line, index) => {
                    if (line !== '{{INPUT}}') {
                        const highlightedLine = this.highlightSyntax(line, task.language);
                        htmlContent += `
                            <div class="code-line">
                                <span class="line-number">${index + 1}</span>
                                <span class="code-content">${highlightedLine}</span>
                            </div>
                        `;
                    } else {
                        // Show placeholder for missing line with blinking cursor effect
                        htmlContent += `
                            <div class="code-line" style="background: rgba(88, 166, 255, 0.05);">
                                <span class="line-number" style="color: var(--primary);">${index + 1}</span>
                                <span class="code-content comment">    // ⟨ Complete this line below ⟩</span>
                            </div>
                        `;
                    }
                });
                
                codeEditor.innerHTML = htmlContent;

                // Update hint
                const hintElement = document.getElementById('hintText');
                if (hintElement) {
                    hintElement.textContent = task.hint;
                }
                
                // Display code options
                const optionsContainer = document.getElementById('codeOptionsGrid');
                if (optionsContainer && task.options && task.options.length > 0) {
                    optionsContainer.innerHTML = '';
                    
                    // Create array with options and mark which is correct
                    const optionsWithCorrectness = task.options.map((option, idx) => ({
                        text: option,
                        isCorrect: idx === 0 // First option is always correct
                    }));
                    
                    // Shuffle options to randomize order
                    for (let i = optionsWithCorrectness.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [optionsWithCorrectness[i], optionsWithCorrectness[j]] = [optionsWithCorrectness[j], optionsWithCorrectness[i]];
                    }
                    
                    optionsWithCorrectness.forEach((optionData, index) => {
                        const optionCard = document.createElement('div');
                        optionCard.className = 'code-option';
                        optionCard.dataset.index = index;
                        optionCard.dataset.isCorrect = optionData.isCorrect;
                        optionCard.dataset.code = optionData.text;
                        
                        const letter = String.fromCharCode(65 + index); // A, B, C, D
                        
                        optionCard.innerHTML = `
                            <div class="option-letter">${letter}</div>
                            <code class="option-code">${this.escapeHtml(optionData.text)}</code>
                        `;
                        
                        // Click handler to help user
                        optionCard.addEventListener('click', () => {
                            // Remove selected class from all options
                            document.querySelectorAll('.code-option').forEach(opt => {
                                opt.classList.remove('selected');
                            });
                            
                            // Add selected class to clicked option
                            optionCard.classList.add('selected');
                            
                            // Optionally auto-fill the input (user can still edit)
                            const codeInput = document.getElementById('codeInput');
                            if (codeInput) {
                                codeInput.value = optionData.text;
                                codeInput.focus();
                            }
                        });
                        
                        optionsContainer.appendChild(optionCard);
                    });
                }
                
                // Focus on input field
                setTimeout(() => {
                    const codeInput = document.getElementById('codeInput');
                    if (codeInput) {
                        codeInput.value = '';
                        codeInput.focus();
                    }
                }, 100);
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            highlightSyntax(code, language) {
                // Escape HTML first
                let highlighted = code
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;');
                
                // Comments first (they should not be processed further)
                highlighted = highlighted.replace(/\/\/(.*)/g, '<span class="comment">//$1</span>');
                highlighted = highlighted.replace(/#(.*)/g, '<span class="comment">#$1</span>');
                
                // Strings (protect them from keyword replacement)
                const stringPlaceholders = [];
                highlighted = highlighted.replace(/"([^"]*)"/g, (match) => {
                    const index = stringPlaceholders.length;
                    stringPlaceholders.push(`<span class="string">${match}</span>`);
                    return `__STRING_${index}__`;
                });
                highlighted = highlighted.replace(/'([^']*)'/g, (match) => {
                    const index = stringPlaceholders.length;
                    stringPlaceholders.push(`<span class="string">${match}</span>`);
                    return `__STRING_${index}__`;
                });
                
                // Keywords (only if not inside comments or strings)
                const keywords = ['return', 'if', 'else', 'for', 'while', 'int', 'void', 'char', 'float', 'double', 
                                'const', 'struct', 'class', 'public', 'private', 'def', 'async', 'await', 'function',
                                'var', 'let', 'import', 'from', 'include', 'using', 'namespace'];
                
                keywords.forEach(keyword => {
                    const regex = new RegExp(`\\b(${keyword})\\b(?![^<]*<\/span>)`, 'g');
                    highlighted = highlighted.replace(regex, '<span class="keyword">$1</span>');
                });
                
                // Function calls
                highlighted = highlighted.replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/g, '<span class="function-name">$1</span>(');
                
                // Numbers
                highlighted = highlighted.replace(/\b(\d+)\b(?![^<]*<\/span>)/g, '<span class="number">$1</span>');
                
                // Restore strings
                stringPlaceholders.forEach((str, index) => {
                    highlighted = highlighted.replace(`__STRING_${index}__`, str);
                });
                
                return highlighted;
            }

            submitCode() {
                const submitBtn = document.getElementById('submitCode');
                
                // FIRST CHECK: If button is disabled, STOP IMMEDIATELY
                if (submitBtn.disabled || this.isSubmitting) {
                    console.log('Blocked duplicate submission attempt');
                    return;
                }
                
                // IMMEDIATELY disable button and set flag (BEFORE ANYTHING ELSE)
                submitBtn.disabled = true;
                this.isSubmitting = true;
                
                const userCode = document.getElementById('codeInput').value.trim();
                const task = this.currentCodingTask;

                if (!userCode) {
                    this.showNotification('⚠️ Please enter some code before submitting!', 'warning');
                    // Re-enable if no code entered
                    submitBtn.disabled = false;
                    this.isSubmitting = false;
                    return;
                }

                // Update UI
                const originalText = submitBtn.textContent;
                submitBtn.textContent = '⏳ Compiling...';
                
                // Disable input field too
                const codeInput = document.getElementById('codeInput');
                if (codeInput) codeInput.disabled = true;

                setTimeout(() => {
                    // Normalize comparison (case insensitive, ignore extra spaces)
                    const normalizedUserCode = userCode.toLowerCase().replace(/\s+/g, ' ').trim();
                    const normalizedSolution = task.solution.toLowerCase().replace(/\s+/g, ' ').trim();

                    const codeOptions = document.querySelectorAll('.code-option');
                    
                    if (normalizedUserCode === normalizedSolution) {
                        submitBtn.textContent = '✓ Success!';
                        submitBtn.style.background = '#34C759';
                        
                        // Highlight correct option
                        codeOptions.forEach(option => {
                            if (option.dataset.isCorrect === 'true') {
                                option.classList.add('correct');
                                option.classList.remove('selected');
                            } else {
                                option.style.opacity = '0.5';
                            }
                        });
                        
                        this.handleSuccessfulCode();
                        this.showNotification(`✓ Compilation successful! ${task.explanation}`, 'success');
                    } else {
                        submitBtn.textContent = '✗ Failed';
                        submitBtn.style.background = '#FF3B30';
                        
                        // Find which option user selected (if any)
                        let userSelectedOption = null;
                        codeOptions.forEach(option => {
                            const optionCode = option.dataset.code.toLowerCase().replace(/\s+/g, ' ').trim();
                            if (optionCode === normalizedUserCode) {
                                userSelectedOption = option;
                            }
                        });
                        
                        // Highlight correct and incorrect options
                        codeOptions.forEach(option => {
                            if (option.dataset.isCorrect === 'true') {
                                // Show correct answer
                                option.classList.add('correct');
                                option.classList.remove('selected');
                                option.style.opacity = '1';
                            } else if (option === userSelectedOption) {
                                // User selected wrong option
                                option.classList.add('incorrect');
                                option.classList.remove('selected');
                                option.style.opacity = '1';
                            } else {
                                // Dim other options
                                option.style.opacity = '0.4';
                                option.classList.remove('selected');
                            }
                        });
                        
                        this.handleFailedCode();
                        this.showNotification(`✗ Compilation failed! ${task.explanation}`, 'error');
                    }

                    setTimeout(() => {
                        // Re-enable everything
                        submitBtn.textContent = originalText;
                        submitBtn.disabled = false;
                        submitBtn.style.background = '';
                        
                        const codeInput = document.getElementById('codeInput');
                        if (codeInput) codeInput.disabled = false;
                        
                        this.closeModal('codingModal');
                        
                        // CRITICAL: Reset flag AFTER closing modal
                        setTimeout(() => {
                            this.isSubmitting = false;
                        }, 100);
                    }, 2000); // Increased from 1500 to 2000ms to see the highlighting
                }, 800);
            }

            handleSuccessfulCode() {
                // Prevent duplicate rewards if called multiple times
                if (this.rewardAlreadyGiven) {
                    console.log('Reward already given, skipping');
                    return;
                }
                this.rewardAlreadyGiven = true;
                
                let progressIncrease = 3.5; // Base progress
                
                // Adam Hojer bonus for programming +50%
                if (this.gameState.character === 'adam') {
                    progressIncrease = 5.25; // +50% bonus
                }
                
                this.gameState.osProgress = Math.min(100, this.gameState.osProgress + progressIncrease);
                this.gameState.money += 10;
                this.gameState.codingTasksCompleted++;
                this.gameState.mood = Math.min(100, this.gameState.mood + 5);

                if (this.gameState.osProgress >= 100) {
                    this.showNotification('🎉 CONGRATULATIONS! You completed your OS! You are the new Linus Torvalds!', 'success');
                    this.unlockAchievement('os_completed');
                }
            }

            handleFailedCode() {
                this.gameState.mood = Math.max(0, this.gameState.mood - 3);
            }

            showRestModal() {
                this.showModal('restModal');
            }

            handleRestAction(action) {
                switch (action) {
                    case 'sleep': {
                        // Проверка: можно спать только если энергия меньше 70
                        if (this.gameState.energy >= 70) {
                            this.showNotification("😴 You're not tired enough to sleep! (Need energy < 70%)", 'warning');
                            return;
                        }
                        
                        // Спать можно только если есть минимум энергии для сна (не в обмороке)
                        if (this.gameState.energy < 5) {
                            this.showNotification("😵 Too exhausted to sleep! Take a walk or rest first.", 'error');
                            return;
                        }
                        
                        // Реалистичная механика сна
                        const energyGain = 60; // Восстанавливаем больше энергии
                        const hungerLoss = 20; // Во время сна становишься голодным
                        const thirstLoss = 25; // Во время сна хочется пить
                        
                        this.gameState.energy = Math.min(100, this.gameState.energy + energyGain);
                        this.gameState.hunger = Math.max(0, this.gameState.hunger - hungerLoss);
                        this.gameState.thirst = Math.max(0, this.gameState.thirst - thirstLoss);
                        this.gameState.mood = Math.min(100, this.gameState.mood + 10);
                        
                        this.showNotification(`😴 Good sleep! +${energyGain} Energy, +10 Mood\n⚠️ -${hungerLoss} Hunger, -${thirstLoss} Thirst`, 'success');
                        break;
                    }
                        
                    case 'eat': {
                        // Проверка: нельзя есть если голод больше 80
                        if (this.gameState.hunger >= 80) {
                            this.showNotification("🍽️ You're too full to eat! (Hunger must be < 80%)", 'warning');
                            return;
                        }
                        
                        if (this.gameState.money >= 25) {
                            const hungerGain = 45;
                            const thirstLoss = 10; // Еда делает тебя более жаждущим
                            const moodGain = 8;
                            
                            this.gameState.money -= 25;
                            this.gameState.hunger = Math.min(100, this.gameState.hunger + hungerGain);
                            this.gameState.thirst = Math.max(0, this.gameState.thirst - thirstLoss);
                            this.gameState.mood = Math.min(100, this.gameState.mood + moodGain);
                            
                            this.showNotification(`🍗 Delicious! +${hungerGain} Hunger, +${moodGain} Mood, -$25\n💧 -${thirstLoss} Thirst (food makes you thirsty)`, 'success');
                        } else {
                            this.showNotification("💰 Not enough money for food! Need $25", 'error');
                            return;
                        }
                        break;
                    }
                        
                    case 'drink': {
                        // Проверка: нельзя пить если жажда больше 85
                        if (this.gameState.thirst >= 85) {
                            this.showNotification("💧 You're not thirsty! (Thirst must be < 85%)", 'warning');
                            return;
                        }
                        
                        if (this.gameState.money >= 15) {
                            const thirstGain = 40;
                            const hungerLoss = 5; // Напитки немного снижают голод
                            const moodGain = 5;
                            
                            this.gameState.money -= 15;
                            this.gameState.thirst = Math.min(100, this.gameState.thirst + thirstGain);
                            this.gameState.hunger = Math.max(0, this.gameState.hunger - hungerLoss);
                            this.gameState.mood = Math.min(100, this.gameState.mood + moodGain);
                            
                            this.showNotification(`💧 Refreshing! +${thirstGain} Thirst, +${moodGain} Mood, -$15`, 'success');
                        } else {
                            this.showNotification("💰 Not enough money for drinks! Need $15", 'error');
                            return;
                        }
                        break;
                    }
                        
                    case 'walk': {
                        // Проверка: нужна минимальная энергия для прогулки
                        if (this.gameState.energy < 15) {
                            this.showNotification("😫 Too tired for a walk! Need at least 15% energy.", 'error');
                            return;
                        }
                        
                        // Проверка: нельзя гулять если настроение уже высокое
                        if (this.gameState.mood >= 85) {
                            this.showNotification("😊 Your mood is already great! No need for a walk.", 'warning');
                            return;
                        }
                        
                        const moodGain = 30;
                        const energyLoss = 12;
                        const hungerLoss = 8; // Прогулка делает голодным
                        const thirstLoss = 12; // Прогулка делает жаждущим
                        
                        this.gameState.mood = Math.min(100, this.gameState.mood + moodGain);
                        this.gameState.energy = Math.max(0, this.gameState.energy - energyLoss);
                        this.gameState.hunger = Math.max(0, this.gameState.hunger - hungerLoss);
                        this.gameState.thirst = Math.max(0, this.gameState.thirst - thirstLoss);
                        
                        this.showNotification(`🚶 Nice walk! +${moodGain} Mood\n⚠️ -${energyLoss} Energy, -${hungerLoss} Hunger, -${thirstLoss} Thirst`, 'success');
                        break;
                    }
                }
                
                this.closeModal('restModal');
                this.updateUI();
            }

            showAchievementsModal() {
                this.updateAchievementsDisplay();
                this.showModal('achievementsModal');
            }

            showSettingsModal() {
                this.showModal('settingsModal');
            }

            updateAchievementsDisplay() {
                const grid = document.getElementById('achievementsGrid');
                grid.innerHTML = '';

                this.achievements.forEach(achievement => {
                    const card = document.createElement('div');
                    card.className = `achievement-card ${achievement.unlocked ? 'unlocked' : ''}`;
                    
                    card.innerHTML = `
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-description">${achievement.description}</div>
                    `;
                    
                    grid.appendChild(card);
                });
            }

            checkAchievements() {
                this.achievements.forEach(achievement => {
                    if (!achievement.unlocked && achievement.check(this.gameState)) {
                        this.unlockAchievement(achievement.id);
                    }
                });
            }

            unlockAchievement(achievementId) {
                const achievement = this.achievements.find(a => a.id === achievementId);
                if (achievement && !achievement.unlocked) {
                    achievement.unlocked = true;
                    this.gameState.achievements.push(achievementId);
                    
                    // Специальное уведомление для достижения
                    const notificationContainer = document.getElementById('notificationContainer');
                    const notification = document.createElement('div');
                    notification.className = 'notification success achievement-notification';
                    notification.style.borderLeft = '5px solid #e3b341';
                    
                    notification.innerHTML = `
                        <div class="notification-icon" style="font-size: 32px;">${achievement.icon}</div>
                        <div class="notification-content">
                            <div class="notification-title">🏆 Achievement Unlocked!</div>
                            <div class="notification-message"><strong>${achievement.name}</strong><br>${achievement.description}</div>
                        </div>
                        <button class="notification-close" onclick="this.parentElement.remove()">&times;</button>
                    `;
                    
                    notificationContainer.appendChild(notification);
                    setTimeout(() => notification.classList.add('show'), 10);
                    
                    // Bonus за достижение
                    this.gameState.money += 50;
                    this.gameState.mood = Math.min(100, this.gameState.mood + 10);
                    
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.classList.remove('show');
                            setTimeout(() => notification.remove(), 300);
                        }
                    }, 8000);
                }
            }

            showModal(modalId) {
                document.getElementById(modalId).style.display = 'flex';
            }

            closeModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
                
                // Clear work modal timeout if closing work modal
                if (modalId === 'workModal' && this.workModalTimeout) {
                    clearTimeout(this.workModalTimeout);
                    this.workModalTimeout = null;
                    this.isAnswering = false; // Reset answering flag too
                }
            }

            showNotification(message, type = 'info') {
                const notificationContainer = document.getElementById('notificationContainer');
                const notificationId = ++this.notificationId;

                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.id = `notification-${notificationId}`;

                const icons = {
                    success: '✅',
                    error: '❌',
                    warning: '⚠️',
                    info: 'ℹ️'
                };

                notification.innerHTML = `
                    <div class="notification-icon">${icons[type]}</div>
                    <div class="notification-content">
                        <div class="notification-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                    <button class="notification-close" onclick="document.getElementById('notification-${notificationId}').remove()">&times;</button>
                `;

                notificationContainer.appendChild(notification);

                // Show notification
                setTimeout(() => notification.classList.add('show'), 10);

                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.classList.remove('show');
                        setTimeout(() => notification.remove(), 300);
                    }
                }, 5000);
            }

            getCharacterName() {
                const names = {
                    tobias: 'Tobias Horvarth',
                    vojtech: 'Vojtech Aloy',
                    hynek: 'Hynek Schiffner',
                    adam: 'Adam Hojer'
                };
                return names[this.gameState.character] || 'Unknown';
            }

            getCharacterClass() {
                const classes = {
                    tobias: 'Database Architect',
                    vojtech: 'Network Specialist',
                    hynek: 'Hardware Engineer',
                    adam: 'Programming Guru'
                };
                return classes[this.gameState.character] || 'Developer';
            }

            initializeQuestions() {
                return {
                    databases: [
                        {
                            question: "What is ACID in database transactions?",
                            options: [
                                "A) Atomicity, Consistency, Isolation, Durability",
                                "B) A coding interface for databases",
                                "C) A type of database architecture"
                            ],
                            correct: 0,
                            explanation: "ACID properties ensure reliable processing of database transactions."
                        },
                        {
                            question: "Which SQL command is used to create a new table?",
                            options: [
                                "A) CREATE TABLE",
                                "B) NEW TABLE", 
                                "C) ADD TABLE"
                            ],
                            correct: 0,
                            explanation: "CREATE TABLE is the standard SQL command for creating new tables."
                        },
                        {
                            question: "What is the purpose of database indexing?",
                            options: [
                                "A) To improve query performance",
                                "B) To encrypt database contents",
                                "C) To backup database files"
                            ],
                            correct: 0,
                            explanation: "Indexes speed up data retrieval operations on database tables."
                        },
                        {
                            question: "Which database model uses documents instead of tables?",
                            options: [
                                "A) NoSQL databases like MongoDB",
                                "B) Relational databases",
                                "C) Graph databases"
                            ],
                            correct: 0,
                            explanation: "NoSQL document databases store data in flexible, JSON-like documents."
                        },
                        {
                            question: "What does SQL stand for?",
                            options: [
                                "A) Structured Query Language",
                                "B) Simple Question Language",
                                "C) System Query Logic"
                            ],
                            correct: 0,
                            explanation: "SQL is the standard language for relational database management systems."
                        },
                        {
                            question: "Which normal form eliminates transitive dependencies?",
                            options: [
                                "A) Third Normal Form (3NF)",
                                "B) Second Normal Form (2NF)",
                                "C) First Normal Form (1NF)"
                            ],
                            correct: 0,
                            explanation: "3NF requires that every non-prime attribute is non-transitively dependent on every key."
                        },
                        {
                            question: "What is a primary key in database design?",
                            options: [
                                "A) A unique identifier for each record",
                                "B) The first column in a table",
                                "C) A backup encryption key"
                            ],
                            correct: 0,
                            explanation: "A primary key uniquely identifies each record in a database table."
                        },
                        {
                            question: "Which join returns all records when there is a match in either table?",
                            options: [
                                "A) FULL OUTER JOIN",
                                "B) INNER JOIN",
                                "C) LEFT JOIN"
                            ],
                            correct: 0,
                            explanation: "FULL OUTER JOIN returns all records when there is a match in left or right table."
                        },
                        {
                            question: "What is database sharding?",
                            options: [
                                "A) Horizontal partitioning of data across multiple servers",
                                "B) Vertical partitioning of columns",
                                "C) Database backup strategy"
                            ],
                            correct: 0,
                            explanation: "Sharding distributes data across multiple machines to improve performance."
                        },
                        {
                            question: "Which database property ensures committed transactions survive failures?",
                            options: [
                                "A) Durability",
                                "B) Atomicity",
                                "C) Consistency"
                            ],
                            correct: 0,
                            explanation: "Durability guarantees that committed transactions remain committed despite system failures."
                        }
                    ],
                    networks: [
                        {
                            question: "What is the main purpose of TCP?",
                            options: [
                                "A) Reliable, ordered data delivery",
                                "B) Fast, connectionless communication",
                                "C) Real-time multimedia streaming"
                            ],
                            correct: 0,
                            explanation: "TCP provides reliable, ordered, and error-checked delivery of data."
                        },
                        {
                            question: "Which protocol is used for secure web browsing?",
                            options: [
                                "A) HTTPS",
                                "B) HTTP",
                                "C) FTP"
                            ],
                            correct: 0,
                            explanation: "HTTPS encrypts web traffic using SSL/TLS for secure communication."
                        },
                        {
                            question: "What does DNS translate?",
                            options: [
                                "A) Domain names to IP addresses",
                                "B) IP addresses to MAC addresses",
                                "C) Domain names to email servers"
                            ],
                            correct: 0,
                            explanation: "DNS translates human-readable domain names to numerical IP addresses."
                        },
                        {
                            question: "Which network device operates at Layer 2 of OSI model?",
                            options: [
                                "A) Switch",
                                "B) Router",
                                "C) Hub"
                            ],
                            correct: 0,
                            explanation: "Switches operate at the Data Link layer (Layer 2) using MAC addresses."
                        },
                        {
                            question: "What is the purpose of a subnet mask?",
                            options: [
                                "A) To divide IP networks into subnets",
                                "B) To hide IP addresses from hackers",
                                "C) To filter network traffic"
                            ],
                            correct: 0,
                            explanation: "Subnet masks define which part of an IP address is network and which is host."
                        },
                        {
                            question: "Which protocol is used for email delivery?",
                            options: [
                                "A) SMTP",
                                "B) POP3",
                                "C) IMAP"
                            ],
                            correct: 0,
                            explanation: "SMTP is used for sending email between servers."
                        },
                        {
                            question: "What is a VLAN used for?",
                            options: [
                                "A) Logical segmentation of network",
                                "B) Virtual private network",
                                "C) Virus protection"
                            ],
                            correct: 0,
                            explanation: "VLANs logically segment networks without requiring physical separation."
                        },
                        {
                            question: "Which wireless security protocol is most secure?",
                            options: [
                                "A) WPA3",
                                "B) WEP",
                                "C) WPA"
                            ],
                            correct: 0,
                            explanation: "WPA3 provides the strongest security for wireless networks."
                        },
                        {
                            question: "What is the purpose of NAT?",
                            options: [
                                "A) To share public IP addresses",
                                "B) To translate domain names",
                                "C) To encrypt network traffic"
                            ],
                            correct: 0,
                            explanation: "NAT allows multiple devices to share a single public IP address."
                        },
                        {
                            question: "Which port does HTTP typically use?",
                            options: [
                                "A) Port 80",
                                "B) Port 443",
                                "C) Port 21"
                            ],
                            correct: 0,
                            explanation: "HTTP typically uses port 80 for unencrypted web traffic."
                        }
                    ],
                    hardware: [
                        {
                            question: "What is the purpose of a CPU cache?",
                            options: [
                                "A) Faster access to frequently used data",
                                "B) Long-term data storage",
                                "C) Graphics processing"
                            ],
                            correct: 0,
                            explanation: "CPU cache stores frequently accessed data for faster retrieval than main memory."
                        },
                        {
                            question: "Which component is responsible for graphics rendering?",
                            options: [
                                "A) GPU",
                                "B) CPU",
                                "C) RAM"
                            ],
                            correct: 0,
                            explanation: "GPU is specialized for parallel processing of graphics data."
                        },
                        {
                            question: "What does BIOS stand for?",
                            options: [
                                "A) Basic Input/Output System",
                                "B) Binary Input Operating System",
                                "C) Basic Integrated Operating Software"
                            ],
                            correct: 0,
                            explanation: "BIOS initializes hardware during boot process."
                        },
                        {
                            question: "Which memory type is non-volatile?",
                            options: [
                                "A) ROM",
                                "B) RAM",
                                "C) Cache"
                            ],
                            correct: 0,
                            explanation: "ROM retains data without power, unlike volatile RAM."
                        },
                        {
                            question: "What is the function of a motherboard?",
                            options: [
                                "A) Connect all computer components",
                                "B) Process graphics",
                                "C) Store operating system"
                            ],
                            correct: 0,
                            explanation: "Motherboard provides electrical connections between components."
                        },
                        {
                            question: "Which interface is commonly used for SSDs?",
                            options: [
                                "A) SATA and NVMe",
                                "B) USB and Ethernet",
                                "C) HDMI and DisplayPort"
                            ],
                            correct: 0,
                            explanation: "SSDs typically use SATA or faster NVMe interfaces."
                        },
                        {
                            question: "What is overclocking?",
                            options: [
                                "A) Running hardware beyond specifications",
                                "B) Cooling system enhancement",
                                "C) Memory optimization"
                            ],
                            correct: 0,
                            explanation: "Overclocking increases clock rates for better performance."
                        },
                        {
                            question: "Which component manages memory allocation?",
                            options: [
                                "A) Memory Controller",
                                "B) CPU",
                                "C) Operating System"
                            ],
                            correct: 0,
                            explanation: "Memory controller handles RAM access and allocation."
                        },
                        {
                            question: "What is the purpose of heatsinks?",
                            options: [
                                "A) Dissipate heat from components",
                                "B) Store thermal energy",
                                "C) Measure temperature"
                            ],
                            correct: 0,
                            explanation: "Heatsinks transfer heat away from electronic components."
                        },
                        {
                            question: "Which bus standard is used for graphics cards?",
                            options: [
                                "A) PCI Express",
                                "B) USB-C",
                                "C) SATA"
                            ],
                            correct: 0,
                            explanation: "PCI Express is the standard interface for modern graphics cards."
                        }
                    ],
                    economics: [
                        {
                            question: "What are variable costs in software development?",
                            options: [
                                "A) Costs that change with production levels",
                                "B) Fixed monthly expenses",
                                "C) One-time setup costs"
                            ],
                            correct: 0,
                            explanation: "Variable costs scale with usage, like cloud computing expenses."
                        },
                        {
                            question: "What does ROI measure?",
                            options: [
                                "A) Return on Investment",
                                "B) Rate of Interest",
                                "C) Risk of Inflation"
                            ],
                            correct: 0,
                            explanation: "ROI calculates the profitability of an investment."
                        },
                        {
                            question: "What is opportunity cost?",
                            options: [
                                "A) Value of the next best alternative",
                                "B) Cost of opportunities",
                                "C) Investment return rate"
                            ],
                            correct: 0,
                            explanation: "Opportunity cost is what you give up when choosing one option over another."
                        },
                        {
                            question: "Which pricing strategy uses psychological pricing?",
                            options: [
                                "A) $9.99 instead of $10.00",
                                "B) Cost-plus pricing",
                                "C) Competitive pricing"
                            ],
                            correct: 0,
                            explanation: "Psychological pricing makes prices seem lower than they are."
                        },
                        {
                            question: "What is a sunk cost?",
                            options: [
                                "A) Irrecoverable past expense",
                                "B) Future investment cost",
                                "C) Variable operating cost"
                            ],
                            correct: 0,
                            explanation: "Sunk costs are past expenses that cannot be recovered."
                        },
                        {
                            question: "What does MVP stand for in business?",
                            options: [
                                "A) Minimum Viable Product",
                                "B) Most Valuable Player",
                                "C) Maximum Value Proposition"
                            ],
                            correct: 0,
                            explanation: "MVP is the simplest version of a product that can be released."
                        },
                        {
                            question: "What is economies of scale?",
                            options: [
                                "A) Cost advantages from increased production",
                                "B) Scaling business operations",
                                "C) Economic growth measurement"
                            ],
                            correct: 0,
                            explanation: "Larger production volumes lead to lower per-unit costs."
                        },
                        {
                            question: "Which financial statement shows profitability?",
                            options: [
                                "A) Income Statement",
                                "B) Balance Sheet",
                                "C) Cash Flow Statement"
                            ],
                            correct: 0,
                            explanation: "Income statement shows revenues, expenses, and profits."
                        },
                        {
                            question: "What is a monopoly?",
                            options: [
                                "A) Single seller in a market",
                                "B) Multiple competing sellers",
                                "C) Government-controlled market"
                            ],
                            correct: 0,
                            explanation: "Monopoly exists when one company dominates a market."
                        },
                        {
                            question: "What does GDP measure?",
                            options: [
                                "A) Total economic output",
                                "B) Government debt",
                                "C) Personal income"
                            ],
                            correct: 0,
                            explanation: "GDP measures the total value of goods and services produced."
                        },
                        {
                            question: "What is the function of a stored procedure?",
                            options: [
                                "A) Execute pre-compiled database logic",
                                "B) Store backup copies",
                                "C) Encrypt database data"
                            ],
                            correct: 0,
                            explanation: "Stored procedures improve performance by pre-compiling SQL statements."
                        },
                        {
                            question: "Which technique prevents SQL injection attacks?",
                            options: [
                                "A) Parameterized queries",
                                "B) String concatenation",
                                "C) Direct user input"
                            ],
                            correct: 0,
                            explanation: "Parameterized queries separate SQL code from data."
                        },
                        {
                            question: "What is database replication used for?",
                            options: [
                                "A) High availability and failover",
                                "B) Deleting old records",
                                "C) Compressing data"
                            ],
                            correct: 0,
                            explanation: "Replication creates redundant copies for reliability."
                        },
                        {
                            question: "Which isolation level prevents dirty reads?",
                            options: [
                                "A) READ COMMITTED",
                                "B) READ UNCOMMITTED",
                                "C) SERIALIZABLE"
                            ],
                            correct: 0,
                            explanation: "READ COMMITTED ensures only committed data is read."
                        },
                        {
                            question: "What is denormalization in database design?",
                            options: [
                                "A) Adding redundancy for performance",
                                "B) Removing all relationships",
                                "C) Encrypting sensitive data"
                            ],
                            correct: 0,
                            explanation: "Denormalization trades storage for query speed."
                        },
                        {
                            question: "What is CAP theorem about?",
                            options: [
                                "A) Consistency, Availability, Partition tolerance",
                                "B) Cache, Application, Performance",
                                "C) Create, Alter, Purge operations"
                            ],
                            correct: 0,
                            explanation: "CAP theorem states you can only guarantee 2 of 3 properties in distributed systems."
                        },
                        {
                            question: "Which command removes all records from a table?",
                            options: [
                                "A) TRUNCATE TABLE",
                                "B) REMOVE TABLE",
                                "C) CLEAR TABLE"
                            ],
                            correct: 0,
                            explanation: "TRUNCATE quickly deletes all rows without logging individual deletions."
                        },
                        {
                            question: "What is a composite key?",
                            options: [
                                "A) Primary key made of multiple columns",
                                "B) Encrypted key",
                                "C) Foreign key reference"
                            ],
                            correct: 0,
                            explanation: "Composite keys use multiple columns to uniquely identify rows."
                        },
                        {
                            question: "What does OLAP stand for?",
                            options: [
                                "A) Online Analytical Processing",
                                "B) Object Linked Application Protocol",
                                "C) Optimized Linear Access Pattern"
                            ],
                            correct: 0,
                            explanation: "OLAP systems are optimized for complex analytical queries."
                        },
                        {
                            question: "What is the OSI model used for?",
                            options: [
                                "A) Standardizing network communications",
                                "B) Operating system installation",
                                "C) Optical signal interference"
                            ],
                            correct: 0,
                            explanation: "OSI model defines 7 layers of network communication."
                        },
                        {
                            question: "Which protocol provides connectionless communication?",
                            options: [
                                "A) UDP",
                                "B) TCP",
                                "C) HTTP"
                            ],
                            correct: 0,
                            explanation: "UDP sends packets without establishing a connection."
                        },
                        {
                            question: "What is a MAC address?",
                            options: [
                                "A) Unique hardware identifier",
                                "B) Apple computer address",
                                "C) Maximum access control"
                            ],
                            correct: 0,
                            explanation: "MAC addresses uniquely identify network interface cards."
                        },
                        {
                            question: "Which attack floods a network with traffic?",
                            options: [
                                "A) DDoS attack",
                                "B) SQL injection",
                                "C) Cross-site scripting"
                            ],
                            correct: 0,
                            explanation: "DDoS overwhelms targets with excessive requests."
                        },
                        {
                            question: "What does QoS stand for in networking?",
                            options: [
                                "A) Quality of Service",
                                "B) Queue of Servers",
                                "C) Quick Operating System"
                            ],
                            correct: 0,
                            explanation: "QoS prioritizes certain types of network traffic."
                        },
                        {
                            question: "Which device operates at Layer 3 of OSI?",
                            options: [
                                "A) Router",
                                "B) Switch",
                                "C) Hub"
                            ],
                            correct: 0,
                            explanation: "Routers work at the Network layer using IP addresses."
                        },
                        {
                            question: "What is the purpose of ARP?",
                            options: [
                                "A) Map IP to MAC addresses",
                                "B) Authenticate remote users",
                                "C) Route packets between networks"
                            ],
                            correct: 0,
                            explanation: "ARP resolves IP addresses to MAC addresses."
                        },
                        {
                            question: "Which encryption protocol secures WiFi?",
                            options: [
                                "A) WPA2/WPA3",
                                "B) SSL/TLS",
                                "C) IPSec"
                            ],
                            correct: 0,
                            explanation: "WPA2 and WPA3 provide wireless network encryption."
                        },
                        {
                            question: "What is bandwidth measured in?",
                            options: [
                                "A) Bits per second",
                                "B) Bytes per packet",
                                "C) Connections per minute"
                            ],
                            correct: 0,
                            explanation: "Bandwidth indicates data transfer rate in bps."
                        },
                        {
                            question: "What does TTL stand for in networking?",
                            options: [
                                "A) Time To Live",
                                "B) Total Transfer Limit",
                                "C) Transmission Tracking Log"
                            ],
                            correct: 0,
                            explanation: "TTL prevents packets from circulating indefinitely."
                        },
                        {
                            question: "What is Moore's Law about?",
                            options: [
                                "A) Transistor density doubling every 2 years",
                                "B) Memory speed improvements",
                                "C) Hard drive capacity growth"
                            ],
                            correct: 0,
                            explanation: "Moore's Law predicted exponential growth in transistor counts."
                        },
                        {
                            question: "Which memory is fastest to access?",
                            options: [
                                "A) CPU Cache",
                                "B) RAM",
                                "C) SSD"
                            ],
                            correct: 0,
                            explanation: "CPU cache provides nanosecond-level access times."
                        },
                        {
                            question: "What does RAID stand for?",
                            options: [
                                "A) Redundant Array of Independent Disks",
                                "B) Rapid Access Integrated Drive",
                                "C) Remote Authentication In Devices"
                            ],
                            correct: 0,
                            explanation: "RAID combines multiple disks for redundancy or performance."
                        },
                        {
                            question: "Which component supplies power to PC components?",
                            options: [
                                "A) PSU (Power Supply Unit)",
                                "B) Motherboard",
                                "C) Battery"
                            ],
                            correct: 0,
                            explanation: "PSU converts AC power to DC for computer components."
                        },
                        {
                            question: "What is thermal throttling?",
                            options: [
                                "A) Reducing performance to prevent overheating",
                                "B) Increasing fan speed",
                                "C) Shutting down the system"
                            ],
                            correct: 0,
                            explanation: "Thermal throttling protects hardware from heat damage."
                        },
                        {
                            question: "Which interface connects CPUs to RAM?",
                            options: [
                                "A) Memory Bus",
                                "B) PCI Express",
                                "C) SATA"
                            ],
                            correct: 0,
                            explanation: "Memory bus transfers data between CPU and RAM."
                        },
                        {
                            question: "What is the function of a chipset?",
                            options: [
                                "A) Manage data flow between components",
                                "B) Generate graphics",
                                "C) Store BIOS"
                            ],
                            correct: 0,
                            explanation: "Chipset coordinates communication between CPU, RAM, and peripherals."
                        },
                        {
                            question: "Which technology improves HDD performance?",
                            options: [
                                "A) Higher RPM",
                                "B) Lower cache",
                                "C) Smaller platters"
                            ],
                            correct: 0,
                            explanation: "Higher RPM reduces seek times and increases transfer rates."
                        },
                        {
                            question: "What does ECC stand for in memory?",
                            options: [
                                "A) Error Correcting Code",
                                "B) Enhanced Cache Control",
                                "C) External Clock Cycle"
                            ],
                            correct: 0,
                            explanation: "ECC memory detects and corrects data corruption."
                        },
                        {
                            question: "What is hyper-threading?",
                            options: [
                                "A) Virtual cores for parallel processing",
                                "B) Faster thread manufacturing",
                                "C) Network cable technology"
                            ],
                            correct: 0,
                            explanation: "Hyper-threading allows one physical core to act as two logical cores."
                        }
                    ]
                };
            }

            initializeCodingTasks() {
                return [
                    {
                        language: "c",
                        code: [
                            "#include <stdio.h>",
                            "",
                            "int main() {",
                            "    // Print welcome message",
                            "    {{INPUT}}",
                            "    return 0;",
                            "}"
                        ],
                        solution: 'printf("Hello, World!\\n");',
                        options: [
                            'printf("Hello, World!\\n");',
                            'print("Hello, World!");',
                            'cout << "Hello, World!";',
                            'echo "Hello, World!";'
                        ],
                        hint: "Use printf to display text to the console",
                        explanation: "The printf function is used for output in C programs."
                    },
                    {
                        language: "c",
                        code: [
                            "int calculate_sum(int a, int b) {",
                            "    // Calculate and return the sum",
                            "    {{INPUT}}",
                            "}"
                        ],
                        solution: "return a + b;",
                        options: [
                            "return a + b;",
                            "return a - b;",
                            "return a * b;",
                            "return sum(a, b);"
                        ],
                        hint: "Return the result of adding a and b",
                        explanation: "The function should return the sum of its two parameters."
                    },
                    {
                        language: "c",
                        code: [
                            "void initialize_kernel() {",
                            "    // Set up basic kernel structures",
                            "    {{INPUT}}",
                            "    printk(\"Kernel initialized\\n\");",
                            "}"
                        ],
                        solution: "kernel_struct = kmalloc(sizeof(struct kernel));",
                        options: [
                            "kernel_struct = kmalloc(sizeof(struct kernel));",
                            "kernel_struct = malloc(sizeof(struct kernel));",
                            "kernel_struct = new kernel_struct();",
                            "kernel_struct = alloc(kernel);"
                        ],
                        hint: "Allocate memory for kernel structure using kmalloc",
                        explanation: "Kernel memory allocation requires special functions like kmalloc."
                    },
                    {
                        language: "c",
                        code: [
                            "int is_even(int number) {",
                            "    // Check if number is even",
                            "    {{INPUT}}",
                            "}"
                        ],
                        solution: "return number % 2 == 0;",
                        options: [
                            "return number % 2 == 0;",
                            "return number / 2 == 0;",
                            "return number % 2 == 1;",
                            "return (number & 1) == 1;"
                        ],
                        hint: "Use modulo operator to check divisibility by 2",
                        explanation: "Even numbers have remainder 0 when divided by 2."
                    },
                    {
                        language: "c",
                        code: [
                            "struct process* create_process() {",
                            "    // Allocate and initialize new process",
                            "    {{INPUT}}",
                            "    return new_process;",
                            "}"
                        ],
                        solution: "struct process* new_process = kmalloc(sizeof(struct process));",
                        options: [
                            "struct process* new_process = kmalloc(sizeof(struct process));",
                            "process* new_process = malloc(sizeof(process));",
                            "struct process* new_process = new process();",
                            "new_process = create(sizeof(struct process));"
                        ],
                        hint: "Allocate memory for process structure",
                        explanation: "Process creation requires memory allocation for process control block."
                    },
                    {
                        language: "asm",
                        code: [
                            "section .text",
                            "global _start",
                            "",
                            "_start:",
                            "    {{INPUT}}",
                            "    mov eax, 1",
                            "    int 0x80"
                        ],
                        solution: "mov ebx, 0",
                        options: [
                            "mov ebx, 0",
                            "mov eax, 0",
                            "mov ecx, 0",
                            "set ebx, 0"
                        ],
                        hint: "Set exit status code in ebx register",
                        explanation: "System call 1 (exit) requires exit status in ebx register."
                    },
                    {
                        language: "python",
                        code: [
                            "def memory_allocate(size):",
                            "    # Allocate memory block",
                            "    {{INPUT}}",
                            "    return block"
                        ],
                        solution: "block = bytearray(size)",
                        options: [
                            "block = bytearray(size)",
                            "block = array(size)",
                            "block = malloc(size)",
                            "block = new byte[size]"
                        ],
                        hint: "Create a byte array of specified size",
                        explanation: "bytearray creates a mutable sequence of bytes for memory simulation."
                    },
                    {
                        language: "python",
                        code: [
                            "class FileSystem:",
                            "    def __init__(self):",
                            "        {{INPUT}}",
                            "        ",
                            "    def create_file(self, name):",
                            "        pass"
                        ],
                        solution: "self.files = {}",
                        options: [
                            "self.files = {}",
                            "self.files = []",
                            "this.files = new Map()",
                            "files = dict()"
                        ],
                        hint: "Initialize a dictionary to store files",
                        explanation: "File systems typically use dictionary-like structures for file management."
                    },
                    {
                        language: "javascript",
                        code: [
                            "function handleInterrupt(irq) {",
                            "    // Process hardware interrupt",
                            "    {{INPUT}}",
                            "    return true;",
                            "}"
                        ],
                        solution: "console.log(`Handling IRQ: ${irq}`);",
                        options: [
                            "console.log(`Handling IRQ: ${irq}`);",
                            "print(f\"Handling IRQ: {irq}\")",
                            "System.out.println(\"Handling IRQ: \" + irq);",
                            "printf(\"Handling IRQ: %d\", irq);"
                        ],
                        hint: "Log the interrupt request number",
                        explanation: "Interrupt handlers often log which interrupt they're processing."
                    },
                    {
                        language: "java",
                        code: [
                            "public class MemoryManager {",
                            "    public void allocateMemory(int size) {",
                            "        // Allocate memory block",
                            "        {{INPUT}}",
                            "        System.out.println(\"Allocated: \" + size + \" bytes\");",
                            "    }",
                            "}"
                        ],
                        solution: "MemoryBlock block = new MemoryBlock(size);",
                        options: [
                            "MemoryBlock block = new MemoryBlock(size);",
                            "var block = new MemoryBlock(size);",
                            "MemoryBlock block = malloc(size);",
                            "let block = new MemoryBlock(size);"
                        ],
                        hint: "Create a new MemoryBlock object",
                        explanation: "Memory allocation creates new block objects in managed systems."
                    },
                    {
                        language: "c",
                        code: [
                            "void init_scheduler() {",
                            "    // Initialize process scheduler",
                            "    {{INPUT}}",
                            "    schedule_next_process();",
                            "}"
                        ],
                        solution: "scheduler_queue = create_queue();",
                        options: [
                            "scheduler_queue = create_queue();",
                            "scheduler_queue = new Queue();",
                            "scheduler_queue = queue.Queue()",
                            "scheduler_queue = init_queue();"
                        ],
                        hint: "Create a queue for process scheduling",
                        explanation: "Schedulers use queues to manage process execution order."
                    },
                    {
                        language: "c",
                        code: [
                            "int factorial(int n) {",
                            "    if (n <= 1) return 1;",
                            "    {{INPUT}}",
                            "}"
                        ],
                        solution: "return n * factorial(n - 1);",
                        options: [
                            "return n * factorial(n - 1);",
                            "return n + factorial(n - 1);",
                            "return factorial(n - 1) / n;",
                            "return n * factorial(n + 1);"
                        ],
                        hint: "Recursive call with n-1",
                        explanation: "Factorial is commonly implemented using recursion."
                    },
                    {
                        language: "python",
                        code: [
                            "def swap(a, b):",
                            "    # Swap two variables",
                            "    {{INPUT}}",
                            "    return a, b"
                        ],
                        solution: "a, b = b, a",
                        options: [
                            "a, b = b, a",
                            "temp = a; a = b; b = temp",
                            "swap(a, b)",
                            "[a, b] = [b, a]"
                        ],
                        hint: "Use Python tuple unpacking",
                        explanation: "Python allows elegant variable swapping with tuple unpacking."
                    },
                    {
                        language: "c",
                        code: [
                            "void* malloc_wrapper(size_t size) {",
                            "    // Safe memory allocation",
                            "    void* ptr = malloc(size);",
                            "    {{INPUT}}",
                            "    return ptr;",
                            "}"
                        ],
                        solution: "if (!ptr) return NULL;",
                        options: [
                            "if (!ptr) return NULL;",
                            "if (ptr == NULL) return NULL;",
                            "if (ptr == 0) return 0;",
                            "if ptr is None: return None"
                        ],
                        hint: "Check if malloc returned NULL",
                        explanation: "Always check malloc return value for allocation failures."
                    },
                    {
                        language: "javascript",
                        code: [
                            "async function loadKernel() {",
                            "    {{INPUT}}",
                            "    const kernel = await fetch('/kernel.bin');",
                            "    return kernel;",
                            "}"
                        ],
                        solution: "try {",
                        options: [
                            "try {",
                            "try:",
                            "begin",
                            "catch {"
                        ],
                        hint: "Start a try-catch block for error handling",
                        explanation: "Async operations should be wrapped in try-catch."
                    },
                    {
                        language: "c",
                        code: [
                            "struct node* create_node(int data) {",
                            "    struct node* new = malloc(sizeof(struct node));",
                            "    {{INPUT}}",
                            "    new->next = NULL;",
                            "    return new;",
                            "}"
                        ],
                        solution: "new->data = data;",
                        options: [
                            "new->data = data;",
                            "new.data = data;",
                            "new->value = data;",
                            "(*new).data = data;"
                        ],
                        hint: "Set the data field of the new node",
                        explanation: "Linked list nodes need data initialization."
                    },
                    {
                        language: "python",
                        code: [
                            "class Thread:",
                            "    def __init__(self, tid):",
                            "        self.tid = tid",
                            "        {{INPUT}}",
                            "        ",
                            "    def run(self):",
                            "        pass"
                        ],
                        solution: "self.state = 'ready'",
                        options: [
                            "self.state = 'ready'",
                            "this.state = 'ready'",
                            "self.status = 'ready'",
                            "state = 'ready'"
                        ],
                        hint: "Initialize thread state",
                        explanation: "Threads typically start in a 'ready' state."
                    },
                    {
                        language: "c",
                        code: [
                            "void context_switch(process* old, process* new) {",
                            "    // Save old process state",
                            "    {{INPUT}}",
                            "    // Load new process state",
                            "    load_context(new);",
                            "}"
                        ],
                        solution: "save_context(old);",
                        options: [
                            "save_context(old);",
                            "store_context(old);",
                            "save_state(old);",
                            "context_save(old);"
                        ],
                        hint: "Call save_context with old process",
                        explanation: "Context switching requires saving current state before loading new one."
                    },
                    {
                        language: "javascript",
                        code: [
                            "function debounce(func, delay) {",
                            "    let timeout;",
                            "    {{INPUT}}",
                            "        clearTimeout(timeout);",
                            "        timeout = setTimeout(() => func(...args), delay);",
                            "    };",
                            "}"
                        ],
                        solution: "return function(...args) {",
                        options: [
                            "return function(...args) {",
                            "return (...args) => {",
                            "function(...args) {",
                            "return lambda(...args): {"
                        ],
                        hint: "Return a function that accepts arguments",
                        explanation: "Debounce delays function execution until after a pause."
                    },
                    {
                        language: "c",
                        code: [
                            "int find_max(int arr[], int size) {",
                            "    int max = arr[0];",
                            "    {{INPUT}}",
                            "        if (arr[i] > max) max = arr[i];",
                            "    return max;",
                            "}"
                        ],
                        solution: "for (int i = 1; i < size; i++)",
                        options: [
                            "for (int i = 1; i < size; i++)",
                            "for (int i = 0; i < size; i++)",
                            "for (i = 1; i <= size; i++)",
                            "for i in range(1, size):"
                        ],
                        hint: "Loop from index 1 to size",
                        explanation: "Find maximum by comparing all elements."
                    },
                    {
                        language: "python",
                        code: [
                            "def binary_search(arr, target):",
                            "    left, right = 0, len(arr) - 1",
                            "    while left <= right:",
                            "        {{INPUT}}",
                            "        if arr[mid] == target: return mid",
                            "        elif arr[mid] < target: left = mid + 1",
                            "        else: right = mid - 1",
                            "    return -1"
                        ],
                        solution: "mid = (left + right) // 2",
                        options: [
                            "mid = (left + right) // 2",
                            "mid = (left + right) / 2",
                            "int mid = (left + right) / 2;",
                            "mid = Math.floor((left + right) / 2)"
                        ],
                        hint: "Calculate middle index",
                        explanation: "Binary search divides the array in half each iteration."
                    },
                    {
                        language: "c",
                        code: [
                            "void bubble_sort(int arr[], int n) {",
                            "    for (int i = 0; i < n-1; i++) {",
                            "        for (int j = 0; j < n-i-1; j++) {",
                            "            {{INPUT}}",
                            "                int temp = arr[j];",
                            "                arr[j] = arr[j+1];",
                            "                arr[j+1] = temp;",
                            "            }",
                            "        }",
                            "    }",
                            "}"
                        ],
                        solution: "if (arr[j] > arr[j+1]) {",
                        options: [
                            "if (arr[j] > arr[j+1]) {",
                            "if (arr[j] < arr[j+1]) {",
                            "if arr[j] > arr[j+1]:",
                            "while (arr[j] > arr[j+1]) {"
                        ],
                        hint: "Compare adjacent elements",
                        explanation: "Bubble sort swaps adjacent elements if they're in wrong order."
                    },
                    {
                        language: "python",
                        code: [
                            "def fibonacci(n):",
                            "    if n <= 1: return n",
                            "    {{INPUT}}",
                            ""
                        ],
                        solution: "return fibonacci(n-1) + fibonacci(n-2)",
                        options: [
                            "return fibonacci(n-1) + fibonacci(n-2)",
                            "return fibonacci(n-2) + fibonacci(n-1)",
                            "return n-1 + n-2",
                            "return fib(n-1) + fib(n-2)"
                        ],
                        hint: "Sum of previous two Fibonacci numbers",
                        explanation: "Fibonacci sequence is defined recursively."
                    },
                    {
                        language: "c",
                        code: [
                            "void reverse_string(char* str) {",
                            "    int len = strlen(str);",
                            "    {{INPUT}}",
                            "        char temp = str[i];",
                            "        str[i] = str[len-1-i];",
                            "        str[len-1-i] = temp;",
                            "    }",
                            "}"
                        ],
                        solution: "for (int i = 0; i < len/2; i++) {",
                        hint: "Loop to middle of string",
                        explanation: "String reversal swaps characters from both ends."
                    },
                    {
                        language: "javascript",
                        code: [
                            "const isPalindrome = (str) => {",
                            "    const cleaned = str.toLowerCase().replace(/[^a-z0-9]/g, '');",
                            "    {{INPUT}}",
                            "};"
                        ],
                        solution: "return cleaned === cleaned.split('').reverse().join('');",
                        hint: "Compare string with its reverse",
                        explanation: "Palindromes read the same forwards and backwards."
                    },
                    {
                        language: "python",
                        code: [
                            "class Stack:",
                            "    def __init__(self):",
                            "        self.items = []",
                            "    ",
                            "    def push(self, item):",
                            "        {{INPUT}}",
                            "    ",
                            "    def pop(self):",
                            "        return self.items.pop() if self.items else None"
                        ],
                        solution: "self.items.append(item)",
                        hint: "Add item to the list",
                        explanation: "Stack push operation adds to the end."
                    },
                    {
                        language: "c",
                        code: [
                            "bool is_prime(int n) {",
                            "    if (n <= 1) return false;",
                            "    {{INPUT}}",
                            "        if (n % i == 0) return false;",
                            "    return true;",
                            "}"
                        ],
                        solution: "for (int i = 2; i * i <= n; i++)",
                        hint: "Check divisors up to square root",
                        explanation: "Prime check only needs to test up to square root of n."
                    },
                    {
                        language: "javascript",
                        code: [
                            "function throttle(func, limit) {",
                            "    let inThrottle;",
                            "    return function(...args) {",
                            "        {{INPUT}}",
                            "        inThrottle = true;",
                            "        func.apply(this, args);",
                            "        setTimeout(() => inThrottle = false, limit);",
                            "    };",
                            "}"
                        ],
                        solution: "if (inThrottle) return;",
                        hint: "Check if already in throttle period",
                        explanation: "Throttle prevents function execution during cooldown."
                    },
                    {
                        language: "python",
                        code: [
                            "def merge_sort(arr):",
                            "    if len(arr) <= 1: return arr",
                            "    mid = len(arr) // 2",
                            "    {{INPUT}}",
                            "    right = merge_sort(arr[mid:])",
                            "    return merge(left, right)"
                        ],
                        solution: "left = merge_sort(arr[:mid])",
                        hint: "Recursively sort left half",
                        explanation: "Merge sort divides array and recursively sorts halves."
                    }
                ];
            }

            initializeAchievements() {
                return [
                    {
                        id: 'first_code',
                        name: 'First Lines of Code',
                        description: 'Complete your first coding task',
                        icon: '👨‍💻',
                        unlocked: false,
                        check: (state) => state.codingTasksCompleted >= 1
                    },
                    {
                        id: 'first_job',
                        name: 'First Paycheck',
                        description: 'Complete your first freelance work',
                        icon: '💵',
                        unlocked: false,
                        check: (state) => state.completedQuestions >= 1
                    },
                    {
                        id: 'money_maker',
                        name: 'Money Maker',
                        description: 'Earn $500',
                        icon: '💰',
                        unlocked: false,
                        check: (state) => state.money >= 500
                    },
                    {
                        id: 'money_master',
                        name: 'Money Master',
                        description: 'Earn $1000',
                        icon: '💎',
                        unlocked: false,
                        check: (state) => state.money >= 1000
                    },
                    {
                        id: 'millionaire',
                        name: 'Tech Millionaire',
                        description: 'Accumulate $2000',
                        icon: '🤑',
                        unlocked: false,
                        check: (state) => state.money >= 2000
                    },
                    {
                        id: 'coding_beginner',
                        name: 'Coding Beginner',
                        description: 'Complete 5 coding tasks',
                        icon: '⌨️',
                        unlocked: false,
                        check: (state) => state.codingTasksCompleted >= 5
                    },
                    {
                        id: 'coding_intermediate',
                        name: 'Intermediate Developer',
                        description: 'Complete 10 coding tasks',
                        icon: '�',
                        unlocked: false,
                        check: (state) => state.codingTasksCompleted >= 10
                    },
                    {
                        id: 'coding_pro',
                        name: 'Pro Developer',
                        description: 'Complete 20 coding tasks',
                        icon: '🚀',
                        unlocked: false,
                        check: (state) => state.codingTasksCompleted >= 20
                    },
                    {
                        id: 'coding_master',
                        name: 'Code Master',
                        description: 'Complete 30 coding tasks',
                        icon: '🎯',
                        unlocked: false,
                        check: (state) => state.codingTasksCompleted >= 30
                    },
                    {
                        id: 'quiz_novice',
                        name: 'Quiz Novice',
                        description: 'Answer 10 questions correctly',
                        icon: '📚',
                        unlocked: false,
                        check: (state) => state.correctAnswers >= 10
                    },
                    {
                        id: 'quiz_expert',
                        name: 'Quiz Expert',
                        description: 'Answer 25 questions correctly',
                        icon: '🎓',
                        unlocked: false,
                        check: (state) => state.correctAnswers >= 25
                    },
                    {
                        id: 'quiz_master',
                        name: 'Quiz Master',
                        description: 'Answer 50 questions correctly',
                        icon: '🏆',
                        unlocked: false,
                        check: (state) => state.correctAnswers >= 50
                    },
                    {
                        id: 'os_started',
                        name: 'OS Development Started',
                        description: 'Reach 25% OS completion',
                        icon: '🔨',
                        unlocked: false,
                        check: (state) => state.osProgress >= 25
                    },
                    {
                        id: 'os_halfway',
                        name: 'Halfway There',
                        description: 'Reach 50% OS completion',
                        icon: '⚙️',
                        unlocked: false,
                        check: (state) => state.osProgress >= 50
                    },
                    {
                        id: 'os_almost',
                        name: 'Almost Complete',
                        description: 'Reach 75% OS completion',
                        icon: '🔩',
                        unlocked: false,
                        check: (state) => state.osProgress >= 75
                    },
                    {
                        id: 'os_completed',
                        name: 'OS Architect',
                        description: 'Complete your operating system 100%',
                        icon: '💻',
                        unlocked: false,
                        check: (state) => state.osProgress >= 100
                    },
                    {
                        id: 'healthy_lifestyle',
                        name: 'Healthy Developer',
                        description: 'Maintain all stats above 80% for 10 minutes',
                        icon: '❤️',
                        unlocked: false,
                        check: (state) => state.gameTime >= 200 && state.health > 80 && state.hunger > 80 && state.thirst > 80 && state.energy > 80 && state.mood > 80
                    },
                    {
                        id: 'workaholic',
                        name: 'Workaholic',
                        description: 'Complete 100 total tasks',
                        icon: '🔥',
                        unlocked: false,
                        check: (state) => (state.completedQuestions + state.codingTasksCompleted) >= 100
                    },
                    {
                        id: 'perfectionist',
                        name: 'Perfectionist',
                        description: 'Answer 10 questions correctly in a row',
                        icon: '✨',
                        unlocked: false,
                        check: (state) => state.correctStreak >= 10
                    },
                    {
                        id: 'survivor',
                        name: 'Survivor',
                        description: 'Survive with health below 20%',
                        icon: '🩹',
                        unlocked: false,
                        check: (state) => state.health > 0 && state.health < 20 && state.gameTime > 50
                    }
                ];
            }
        }

        // ===== COSMIC BACKGROUND GENERATOR =====
        function createStars() {
            const container = document.getElementById('cosmicBackground');
            const starsCount = 300; // Увеличено для более плотного звёздного неба
            
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // Разные размеры звёзд для реалистичности
                const size = Math.random() * 2.5 + 0.5;
                const left = Math.random() * 100;
                const top = Math.random() * 100;
                const delay = Math.random() * 4;
                const duration = Math.random() * 3 + 2;
                
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${left}%`;
                star.style.top = `${top}%`;
                star.style.animationDelay = `${delay}s`;
                star.style.animationDuration = `${duration}s`;
                
                container.appendChild(star);
            }
        }

        function createNebulas() {
            const container = document.getElementById('cosmicBackground');
            const nebulaCount = 3;
            
            for (let i = 0; i < nebulaCount; i++) {
                const nebula = document.createElement('div');
                nebula.classList.add('nebula');
                
                const width = Math.random() * 600 + 400;
                const height = Math.random() * 600 + 400;
                const left = Math.random() * 80 - 10; // Могут выходить за края для эффекта
                const top = Math.random() * 80 - 10;
                
                // Фиолетовые и синие оттенки как на картинке
                const colors = [
                    '99, 102, 241',    // фиолетовый
                    '139, 92, 246',    // пурпурный
                    '59, 130, 246'     // синий
                ];
                const color = colors[i % colors.length];
                
                nebula.style.width = `${width}px`;
                nebula.style.height = `${height}px`;
                nebula.style.left = `${left}%`;
                nebula.style.top = `${top}%`;
                nebula.style.backgroundColor = `rgba(${color}, 0.2)`;
                nebula.style.animation = `nebulaFloat ${20 + Math.random() * 10}s ease-in-out infinite`;
                
                container.appendChild(nebula);
            }
        }

        function createShootingStars() {
            const container = document.getElementById('cosmicBackground');
            
            // Создаём случайные падающие звёзды с интервалом
            setInterval(() => {
                if (Math.random() > 0.7) { // 30% шанс создания
                    const shootingStar = document.createElement('div');
                    shootingStar.classList.add('shooting-star');
                    
                    const width = Math.random() * 100 + 50;
                    const startX = Math.random() * 100;
                    const startY = Math.random() * 50;
                    
                    shootingStar.style.width = `${width}px`;
                    shootingStar.style.left = `${startX}%`;
                    shootingStar.style.top = `${startY}%`;
                    
                    container.appendChild(shootingStar);
                    
                    // Удаляем элемент после анимации
                    setTimeout(() => {
                        shootingStar.remove();
                    }, 3000);
                }
            }, 2000);
        }

        function createFloatingElements() {
            const container = document.getElementById('floatingElements');
            const elementsCount = 10;
            
            for (let i = 0; i < elementsCount; i++) {
                const element = document.createElement('div');
                element.classList.add('floating-element');
                
                const size = Math.random() * 300 + 100;
                const left = Math.random() * 100;
                const top = Math.random() * 100;
                const delay = Math.random() * 5;
                
                element.style.width = `${size}px`;
                element.style.height = `${size}px`;
                element.style.left = `${left}%`;
                element.style.top = `${top}%`;
                element.style.animationDelay = `${delay}s`;
                
                container.appendChild(element);
            }
        }

        // Initialize the game and cosmic background when the page loads
        window.addEventListener('load', () => {
            createStars();
            createNebulas();
            createShootingStars();
            window.game = new OSTycoonGame();
        });
    </script>
</body>
</html>
    